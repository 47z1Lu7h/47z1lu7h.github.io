<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> PostgreSQL Large Objects | 47z!h4Ck </title> <meta name="author" content="47z!Lu7h "> <meta name="description" content=""> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="/assets/img/logos/m1N147z1.png?c5fa12f00bf81b0bfdfb738a6722b18c"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://47z1lu7h.github.io/docs/hacking/cheetsheets/SQL-Injection/postgresql-injection/big-binary-files-upload-postgresql/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> 47z!h4Ck </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">\ h0m3 / </a> </li> <li class="nav-item active"> <a class="nav-link" href="/docs/">/ d0Cs \ <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">\ bl0g / </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">/ m0Re \ </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/about/">about</a> <div class="dropdown-divider"></div> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/repos/">repositories</a> <div class="dropdown-divider"></div> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/cv/">Cv</a> <div class="dropdown-divider"></div> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/news/">news</a> <div class="dropdown-divider"></div> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"><div class="post"> <header class="post-header"> <h1 class="post-title">PostgreSQL Large Objects</h1> <p class="post-description"></p> </header> <article> <p><br/></p> <h3 id="postgresql-large-objects">PostgreSQL Large Objects</h3> <p>PostgreSQL offers a structure known as <strong>large objects</strong>, accessible via the <code class="language-plaintext highlighter-rouge">pg_largeobject</code> table, designed for storing large data types, such as images or PDF documents. This approach is advantageous over the <code class="language-plaintext highlighter-rouge">COPY TO</code> function as it enables the <strong>exportation of data back to the file system</strong>, ensuring an exact replica of the original file is maintained.</p> <p>For <strong>storing a complete file</strong> within this table, an object must be created in the <code class="language-plaintext highlighter-rouge">pg_largeobject</code> table (identified by a LOID), followed by the insertion of data chunks, each 2KB in size, into this object. It is crucial that these chunks are exactly 2KB in size (with the possible exception of the last chunk) to ensure the exporting function performs correctly.</p> <p>To <strong>divide your binary data</strong> into 2KB chunks, the following commands can be executed:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">split</span> <span class="nt">-b</span> 2048 your_file <span class="c"># Creates 2KB sized files</span>
</code></pre></div></div> <p>For encoding each file into Base64 or Hex, the commands below can be used:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">base64</span> <span class="nt">-w</span> 0 &lt;Chunk_file&gt; <span class="c"># Encodes in Base64 in one line</span>
xxd <span class="nt">-ps</span> <span class="nt">-c</span> 99999999999 &lt;Chunk_file&gt; <span class="c"># Encodes in Hex in one line</span>
</code></pre></div></div> <p><strong>Important</strong>: When automating this process, ensure to send chunks of 2KB of clear-text bytes. Hex encoded files will require 4KB of data per chunk due to doubling in size, while Base64 encoded files follow the formula <code class="language-plaintext highlighter-rouge">ceil(n / 3) * 4</code>.</p> <p>The contents of the large objects can be viewed for debugging purposes using:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">loid</span><span class="p">,</span> <span class="n">pageno</span><span class="p">,</span> <span class="n">encode</span><span class="p">(</span><span class="k">data</span><span class="p">,</span> <span class="s1">'escape'</span><span class="p">)</span> <span class="k">from</span> <span class="n">pg_largeobject</span><span class="p">;</span>
</code></pre></div></div> <p><br/></p> <h3 id="using-lo_creat--base64">Using <code class="language-plaintext highlighter-rouge">lo_creat</code> &amp; Base64</h3> <p>To store binary data, a LOID is first created:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">lo_creat</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>       <span class="c1">-- Creates a new, empty large object</span>
<span class="k">SELECT</span> <span class="n">lo_create</span><span class="p">(</span><span class="mi">173454</span><span class="p">);</span>  <span class="c1">-- Attempts to create a large object with a specific OID</span>
</code></pre></div></div> <p>In situations requiring precise control, such as exploiting a Blind SQL Injection, <code class="language-plaintext highlighter-rouge">lo_create</code> is preferred for specifying a fixed LOID.</p> <p>Data chunks can then be inserted as follows:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">pg_largeobject</span> <span class="p">(</span><span class="n">loid</span><span class="p">,</span> <span class="n">pageno</span><span class="p">,</span> <span class="k">data</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">173454</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">decode</span><span class="p">(</span><span class="s1">'&lt;B64 chunk1&gt;'</span><span class="p">,</span> <span class="s1">'base64'</span><span class="p">));</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">pg_largeobject</span> <span class="p">(</span><span class="n">loid</span><span class="p">,</span> <span class="n">pageno</span><span class="p">,</span> <span class="k">data</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">173454</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">decode</span><span class="p">(</span><span class="s1">'&lt;B64 chunk2&gt;'</span><span class="p">,</span> <span class="s1">'base64'</span><span class="p">));</span>

</code></pre></div></div> <p>To export and potentially delete the large object after use:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">lo_export</span><span class="p">(</span><span class="mi">173454</span><span class="p">,</span> <span class="s1">'/tmp/your_file'</span><span class="p">);</span>
<span class="k">SELECT</span> <span class="n">lo_unlink</span><span class="p">(</span><span class="mi">173454</span><span class="p">);</span>  <span class="c1">-- Deletes the specified large object</span>
</code></pre></div></div> <p><br/></p> <h3 id="using-lo_import--hex">Using <code class="language-plaintext highlighter-rouge">lo_import</code> &amp; Hex</h3> <p>The <code class="language-plaintext highlighter-rouge">lo_import</code> function can be utilized to create and specify a LOID for a large object:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">lo_import</span><span class="p">(</span><span class="s1">'/path/to/file'</span><span class="p">);</span>
<span class="k">select</span> <span class="n">lo_import</span><span class="p">(</span><span class="s1">'/path/to/file'</span><span class="p">,</span> <span class="mi">173454</span><span class="p">);</span>
</code></pre></div></div> <p>Following object creation, data is inserted per page, ensuring each chunk does not exceed 2KB:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">update</span> <span class="n">pg_largeobject</span> <span class="k">set</span> <span class="k">data</span><span class="o">=</span><span class="n">decode</span><span class="p">(</span><span class="s1">'&lt;HEX&gt;'</span><span class="p">,</span> <span class="s1">'hex'</span><span class="p">)</span> <span class="k">where</span> <span class="n">loid</span><span class="o">=</span><span class="mi">173454</span> <span class="k">and</span> <span class="n">pageno</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="k">update</span> <span class="n">pg_largeobject</span> <span class="k">set</span> <span class="k">data</span><span class="o">=</span><span class="n">decode</span><span class="p">(</span><span class="s1">'&lt;HEX&gt;'</span><span class="p">,</span> <span class="s1">'hex'</span><span class="p">)</span> <span class="k">where</span> <span class="n">loid</span><span class="o">=</span><span class="mi">173454</span> <span class="k">and</span> <span class="n">pageno</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</code></pre></div></div> <p>To complete the process, the data is exported and the large object is deleted:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">lo_export</span><span class="p">(</span><span class="mi">173454</span><span class="p">,</span> <span class="s1">'/path/to/your_file'</span><span class="p">);</span>
<span class="k">select</span> <span class="n">lo_unlink</span><span class="p">(</span><span class="mi">173454</span><span class="p">);</span>  <span class="c1">-- Deletes the specified large object</span>
</code></pre></div></div> <p><br/></p> <h3 id="limitations">Limitations</h3> <p>It’s noted that <strong>large objects may have ACLs</strong> (Access Control Lists), potentially restricting access even to objects created by your user. However, older objects with permissive ACLs may still be accessible for content exfiltration.</p> </article> </div> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> -[47z!Lu7h] -[Love is life. And if you miss love, you miss life. ]-[2025]- </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?4a129fbf39254905f505c7246e641eaf"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>